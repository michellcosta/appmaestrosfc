const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-DRrYElTa.js","assets/vendor-ui-Cg0qxSES.js","assets/vendor-react-CyD6OLG_.js","assets/check-Cf6Eusfg.js","assets/dialog-C8tkcOsA.js","assets/input-uMYoR_2G.js","assets/users-CT76zCld.js","assets/search-Vi8H8w3g.js","assets/circle-check-DyOVLLaD.js","assets/map-pin-D5gf0CoB.js","assets/sun-CA4sBXJa.js","assets/save-CUOiOV_5.js","assets/badge-hWvPWwxj.js","assets/vendor-router-VFXGavtY.js","assets/crown-CyBj_N2G.js","assets/shield-DWCzQdRN.js","assets/usePermissions-C7BJFuWB.js","assets/calendar-BrX1EaW7.js","assets/plus-BLqvMSWc.js","assets/useTeamDrawConvex-vOr6iHt4.js","assets/middleware-BLDYzNRS.js","assets/gamesStore-CEKKs3cA.js","assets/clock-DeGhZLZS.js","assets/user-plus-2isPmhvc.js","assets/vendor-pdf-oqmhCI76.js","assets/vendor-utils-CrFdsnXa.js","assets/Match-BTMlsU3c.js","assets/useAutoSync-DHWSpEGJ.js","assets/matchStore-Cq_uepae.js","assets/label-CfKHBYYN.js","assets/select-DPwYioei.js","assets/tabs-DCR6OKyG.js","assets/trash-2-__SYsBQH.js","assets/sparkles-O0siDYuT.js","assets/database-Ce_Wfjf8.js","assets/Vote-YqiAEZAQ.js","assets/InvitesApprovals-DhG3Izh1.js","assets/Perfil-Ei1bqqC9.js","assets/mail-C10ji3et.js","assets/copy-BU4q-tvH.js","assets/square-pen-Z_vz8fGA.js","assets/log-out-DoNdvP1Z.js","assets/Ranking-MpqNGIkS.js","assets/RestrictedAccess-BiBW0IHv.js","assets/dollar-sign-BIl9i7n7.js","assets/settings-CXYkW_Aa.js","assets/OwnerDashboardMobile-DdM_uqu-.js","assets/eye-BFtLU7hx.js","assets/user-check-C0OIbiVK.js","assets/CreateOwner-NSH4t0u7.js","assets/CreateOwnerWithGoogle-CwHwEhUn.js","assets/ownerProtection-B5CmDnhe.js","assets/arrow-left-DWClACLR.js","assets/Login-Dmbdsjdl.js","assets/useGoogleAuth-BrkrQYSG.js","assets/globe-D87ER12r.js","assets/callback-Bf-Qli0E.js","assets/CreateInvite-DJDd5QnA.js","assets/AcceptInvite-D4COi_FJ.js","assets/ManageAdmins-C8bBcyNk.js","assets/user-minus-Dem5BnMf.js","assets/ConfigureAccess-5Xv_d3KM.js","assets/ApproveParticipants-f2E-mcu7.js","assets/ManagePlayersConvex-DMzQ9Xn1.js","assets/TeamDrawMobile-ByUbjP-S.js","assets/ListUsers-HBmnXLdC.js","assets/MigratePlayersToConvex-F_UPUxXL.js","assets/ForceUserSync-CFNd8VFC.js"])))=>i.map(i=>d[i]);
import{j as e,S as t}from"./vendor-ui-Cg0qxSES.js";import{a as s,r,c as n}from"./vendor-react-CyD6OLG_.js";import{u as o,a as i,R as a,b as c,N as l,B as u}from"./vendor-router-VFXGavtY.js";import{_ as h}from"./vendor-pdf-oqmhCI76.js";import{c as d,t as f}from"./vendor-utils-CrFdsnXa.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var g={},m=s;g.createRoot=m.createRoot,g.hydrateRoot=m.hydrateRoot;const p=(...e)=>e.filter((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var y={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const v=r.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:o="",children:i,iconNode:a,...c},l)=>r.createElement("svg",{ref:l,...y,width:t,height:t,stroke:e,strokeWidth:n?24*Number(s)/Number(t):s,className:p("lucide",o),...c},[...a.map(([e,t])=>r.createElement(e,t)),...Array.isArray(i)?i:[i]])),b=(e,t)=>{const s=r.forwardRef(({className:s,...n},o)=>{return r.createElement(v,{ref:o,iconNode:t,className:p(`lucide-${i=e,i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,s),...n});var i});return s.displayName=`${e}`,s},w=b("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),x=b("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),k=b("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),S=b("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),j=b("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),C=b("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),R=b("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),A=b("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),T=b("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),E=b("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),q=b("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),M=b("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),_=b("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),I=b("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),N=b("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),O=b("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),L=b("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),P=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,$=d,V=(e,t)=>s=>{var r;if(null==(null==t?void 0:t.variants))return $(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:n,defaultVariants:o}=t,i=Object.keys(n).map(e=>{const t=null==s?void 0:s[e],r=null==o?void 0:o[e];if(null===t)return null;const i=P(t)||P(r);return n[e][i]}),a=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{}),c=null==t||null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...n}=t;return Object.entries(n).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...o,...a}[t]):{...o,...a}[t]===s})?[...e,s,r]:e},[]);return $(e,i,c,null==s?void 0:s.class,null==s?void 0:s.className)};function Q(...e){return f(d(e))}const D=V("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 relative overflow-hidden group active:transform active:scale-95 motion-reduce:transition-none motion-reduce:active:transform-none",{variants:{variant:{default:"bg-maestros-green text-white hover:bg-maestros-green/90 shadow-lg hover:shadow-xl transition-all duration-300 focus-visible:ring-maestros-green",destructive:"bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 shadow-lg hover:shadow-xl before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/20 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity before:duration-300 focus-visible:ring-red-500",outline:"border-2 border-gradient-to-r from-blue-500 to-purple-500 bg-white/80 backdrop-blur-sm hover:bg-white/90 hover:shadow-lg text-gray-700 hover:text-gray-900 dark:bg-zinc-900 dark:text-zinc-100 dark:border-zinc-600 dark:hover:bg-zinc-800 focus-visible:ring-blue-500",secondary:"bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800 hover:from-gray-200 hover:to-gray-300 dark:from-zinc-800 dark:to-zinc-700 dark:text-zinc-100 dark:hover:from-zinc-700 dark:hover:to-zinc-600 shadow-md hover:shadow-lg focus-visible:ring-gray-500",ghost:"hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 hover:text-blue-700 transition-all duration-300 focus-visible:ring-blue-500",link:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 underline-offset-4 hover:underline hover:from-blue-700 hover:to-purple-700 focus-visible:ring-blue-500",success:"bg-gradient-to-r from-green-500 to-emerald-600 text-white hover:from-green-600 hover:to-emerald-700 shadow-lg hover:shadow-xl before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/20 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity before:duration-300 focus-visible:ring-green-500",warning:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white hover:from-yellow-600 hover:to-orange-600 shadow-lg hover:shadow-xl before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/20 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity before:duration-300 focus-visible:ring-yellow-500",team:"bg-gradient-to-br from-white to-gray-50 text-gray-700 border-2 border-gray-200 hover:border-blue-300 hover:shadow-lg hover:from-blue-50 hover:to-purple-50 backdrop-blur-sm focus-visible:ring-blue-500"},size:{default:"h-11 px-6 py-2",sm:"h-9 rounded-lg px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base font-semibold",xl:"h-14 rounded-2xl px-10 text-lg font-bold shadow-xl",icon:"h-10 w-10 rounded-xl"}},defaultVariants:{variant:"default",size:"default"}}),F=r.forwardRef(({className:s,variant:r,size:n,asChild:o=!1,loading:i=!1,loadingText:a,icon:c,iconPosition:l="left",children:u,disabled:h,...d},f)=>{const g=o?t:"button",m=h||i,p=i&&a?a:u;return o?e.jsx(g,{className:Q(D({variant:r,size:n,className:s})),ref:f,disabled:m,"aria-busy":i,"aria-disabled":m,...d,children:u}):e.jsxs(g,{className:Q(D({variant:r,size:n,className:s})),ref:f,disabled:m,"aria-busy":i,"aria-disabled":m,...d,children:[i&&e.jsx(A,{className:"animate-spin",size:16,"aria-hidden":"true"}),!i&&c&&"left"===l&&e.jsx("span",{"aria-hidden":"true",children:c}),e.jsx("span",{children:p}),!i&&c&&"right"===l&&e.jsx("span",{"aria-hidden":"true",children:c})]})});F.displayName="Button";const z=r.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:Q("rounded-2xl border bg-card text-card-foreground shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] group relative overflow-hidden before:absolute before:inset-0 before:bg-gradient-to-br before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity before:duration-300 dark:before:from-white/5 dark:shadow-2xl dark:hover:shadow-3xl",t),...s}));z.displayName="Card";const U=r.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:Q("flex flex-col space-y-2 p-6 relative z-10",t),...s}));U.displayName="CardHeader";const W=r.forwardRef(({className:t,...s},r)=>e.jsx("h3",{ref:r,className:Q("text-2xl font-bold leading-none tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-gray-800 to-gray-600 group-hover:from-blue-700 group-hover:to-purple-700 transition-all duration-300 dark:from-gray-100 dark:to-gray-300 dark:group-hover:from-blue-400 dark:group-hover:to-purple-400",t),...s}));W.displayName="CardTitle";const B=r.forwardRef(({className:t,...s},r)=>e.jsx("p",{ref:r,className:Q("text-sm text-gray-600 group-hover:text-gray-700 transition-colors duration-300 dark:text-zinc-200 dark:group-hover:text-zinc-100",t),...s}));B.displayName="CardDescription";const J=r.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:Q("p-6 pt-0 relative z-10",t),...s}));J.displayName="CardContent";r.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:Q("flex items-center p-6 pt-0 relative z-10",t),...s})).displayName="CardFooter";class H extends r.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}handleReset=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})};handleGoHome=()=>{window.location.href="/"};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 flex items-center justify-center p-4",children:e.jsxs(z,{className:"w-full max-w-md shadow-xl border-red-200 dark:border-red-800",children:[e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center mb-4",children:e.jsx(M,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx(W,{className:"text-xl text-red-800 dark:text-red-200",children:"Oops! Algo deu errado"})]}),e.jsxs(J,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:"Ocorreu um erro inesperado. Nossa equipe foi notificada e está trabalhando para corrigir o problema."}),!1,e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(F,{onClick:this.handleReset,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Tentar Novamente"]}),e.jsxs(F,{onClick:this.handleGoHome,variant:"outline",className:"flex-1",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Ir para Home"]})]}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Se o problema persistir, entre em contato com o suporte."})})]})]})}):this.props.children}}const G=r.createContext(void 0);function X({children:t}){const[s,n]=r.useState([]),o=r.useCallback(e=>{const t=Math.random().toString(36).substring(2,15),s={...e,id:t};n(e=>[...e,s]);const r=e.duration||5e3;r>0&&setTimeout(()=>{i(t)},r)},[]),i=r.useCallback(e=>{n(t=>t.filter(t=>t.id!==e))},[]),a=r.useCallback(()=>{n([])},[]);return e.jsxs(G.Provider,{value:{toasts:s,addToast:o,removeToast:i,clearToasts:a},children:[t,e.jsx(Z,{toasts:s,onRemove:i})]})}function Z({toasts:t,onRemove:s}){return e.jsx("div",{className:"fixed top-4 right-4 z-50 flex flex-col gap-2 max-w-sm w-full pointer-events-none","aria-live":"polite","aria-label":"Notificações",children:t.map(t=>e.jsx(K,{toast:t,onRemove:s},t.id))})}function K({toast:t,onRemove:s}){return r.useEffect(()=>{const e=`${t.type}: ${t.title}${t.description?". "+t.description:""}`,s=document.createElement("div");s.setAttribute("aria-live","assertive"),s.setAttribute("aria-atomic","true"),s.className="sr-only",s.textContent=e,document.body.appendChild(s),setTimeout(()=>{document.body.contains(s)&&document.body.removeChild(s)},1e3)},[t]),e.jsxs("div",{role:"alert","aria-live":"polite","aria-atomic":"true",className:(e=>{const t="pointer-events-auto relative flex items-start gap-3 p-4 rounded-lg shadow-lg backdrop-blur-sm border transition-all duration-300 animate-smooth-fade-in";switch(e){case"success":return`${t} bg-green-50/95 border-green-200 text-green-800`;case"error":return`${t} bg-red-50/95 border-red-200 text-red-800`;case"warning":return`${t} bg-yellow-50/95 border-yellow-200 text-yellow-800`;case"info":return`${t} bg-blue-50/95 border-blue-200 text-blue-800`;default:return`${t} bg-gray-50/95 border-gray-200 text-gray-800`}})(t.type),children:[(t=>{const s={className:"h-5 w-5 mt-0.5 flex-shrink-0","aria-hidden":"true"};switch(t){case"success":return e.jsx(S,{...s,className:`${s.className} text-green-600`});case"error":return e.jsx(k,{...s,className:`${s.className} text-red-600`});case"warning":return e.jsx(M,{...s,className:`${s.className} text-yellow-600`});case"info":return e.jsx(R,{...s,className:`${s.className} text-blue-600`});default:return e.jsx(R,{...s,className:`${s.className} text-gray-600`})}})(t.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm mb-1",children:t.title}),t.description&&e.jsx("p",{className:"text-sm opacity-90",children:t.description}),t.action&&e.jsx(F,{variant:"ghost",size:"sm",onClick:t.action.onClick,className:"mt-2 h-auto p-0 text-sm font-medium underline hover:no-underline",children:t.action.label})]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>s(t.id),className:"flex-shrink-0 h-6 w-6 rounded-md hover:bg-black/10 focus:ring-2 focus:ring-offset-2 focus:ring-current","aria-label":`Fechar notificação: ${t.title}`,children:e.jsx(O,{className:"h-4 w-4","aria-hidden":"true"})})]})}function Y(){const{addToast:e}=function(){const e=r.useContext(G);if(!e)throw new Error("useToast must be used within a ToastProvider");return e}();return{success:(t,s,r)=>e({type:"success",title:t,description:s,action:r}),error:(t,s,r)=>e({type:"error",title:t,description:s,action:r}),warning:(t,s,r)=>e({type:"warning",title:t,description:s,action:r}),info:(t,s,r)=>e({type:"info",title:t,description:s,action:r}),custom:t=>e(t)}}const ee="maestros-install-popup-shown";function te(){const[t,s]=r.useState(null),[n,o]=r.useState(!1),[i,a]=r.useState(!1),[c,l]=r.useState("browser"),{success:u,error:h}=Y();r.useEffect(()=>{if(localStorage.getItem(ee)||(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)&&(a(!0),1))return;const e=e=>{e.preventDefault(),s(e),l("browser"),setTimeout(()=>{localStorage.getItem(ee)||o(!0)},3e3)},r=()=>{a(!0),o(!1),localStorage.setItem(ee,"true"),u("App instalado!","O App Maestros FC foi instalado com sucesso!")},n=()=>{window.matchMedia("(display-mode: standalone)").matches&&(a(!0),o(!1),localStorage.setItem(ee,"true"))};window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",r),window.matchMedia("(display-mode: standalone)").addEventListener("change",n);const c=setTimeout(()=>{t||i||localStorage.getItem(ee)||(l("manual"),o(!0))},1e4);return()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",r),window.matchMedia("(display-mode: standalone)").removeEventListener("change",n),clearTimeout(c)}},[t,i,u]);return i||!n?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsx(z,{className:"w-full max-w-md mx-auto shadow-2xl border-0 bg-white dark:bg-gray-900",children:e.jsxs(J,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Instalar Maestros FC"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tenha acesso rápido e offline ao app na sua tela inicial"})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Acesso instantâneo"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(N,{className:"w-4 h-4 text-green-600"})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Funciona offline"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center",children:e.jsx(q,{className:"w-4 h-4 text-purple-600"})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Experiência nativa"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(F,{onClick:async()=>{if(t)try{t.prompt();const{outcome:e}=await t.userChoice;"accepted"===e?(u("Instalando...","O app está sendo instalado!"),localStorage.setItem(ee,"true")):h("Instalação cancelada","Você pode instalar depois pelo menu do browser"),s(null),o(!1),localStorage.setItem(ee,"true")}catch(e){h("Erro na instalação","Tente novamente pelo menu do browser")}else o(!1),localStorage.setItem(ee,"true"),u("Instruções de instalação","Siga as instruções abaixo para instalar o app")},className:"flex-1 bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"browser"===c?"Instalar Agora":"Ver Instruções"]}),e.jsx(F,{variant:"outline",onClick:()=>{o(!1),localStorage.setItem(ee,"true")},className:"px-4",children:e.jsx(O,{className:"w-4 h-4"})})]}),"manual"===c&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"📱 iPhone/iPad:"}),e.jsxs("ol",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"1. Toque no botão de compartilhar (📤)"}),e.jsx("li",{children:'2. Selecione "Adicionar à Tela Inicial"'}),e.jsx("li",{children:'3. Toque em "Adicionar"'})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-green-800 dark:text-green-200 mb-2",children:"🤖 Android:"}),e.jsxs("ol",{className:"text-xs text-green-700 dark:text-green-300 space-y-1",children:[e.jsx("li",{children:"1. Toque no menu (⋮) do navegador"}),e.jsx("li",{children:'2. Selecione "Instalar app"'}),e.jsx("li",{children:"3. Confirme a instalação"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4",children:"Esta mensagem aparece apenas uma vez"})]})})})}function se(){const{updateAvailable:t,isUpdating:s,updateApp:n,dismissUpdate:o}=function(){const[e,t]=r.useState(!1),[s,n]=r.useState(!1),{success:o,error:i}=Y();return r.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.ready.then(e=>{e.addEventListener("updatefound",()=>{const s=e.installing;s&&s.addEventListener("statechange",()=>{"installed"===s.state&&navigator.serviceWorker.controller&&(t(!0),o("Nova versão disponível!","Clique para atualizar o app"))})})}),navigator.serviceWorker.addEventListener("message",e=>{e.data&&"UPDATE_AVAILABLE"===e.data.type&&t(!0)}))},[o]),{updateAvailable:e,isUpdating:s,updateApp:async()=>{if("serviceWorker"in navigator){n(!0);try{const e=await navigator.serviceWorker.ready;e.waiting?(e.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload()):(await e.update(),o("Verificando atualizações...","Aguarde um momento"))}catch(e){i("Erro na atualização","Tente novamente")}finally{n(!1)}}else i("Erro","Service Worker não suportado")},dismissUpdate:()=>{t(!1)}}}();return t?e.jsx("div",{className:"fixed top-4 left-4 right-4 z-50 animate-slide-in-right",children:e.jsx(z,{className:"bg-gradient-primary text-white border-0 shadow-lg",children:e.jsx(J,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Nova versão disponível!"}),e.jsx("p",{className:"text-sm opacity-90",children:"Atualize para ter acesso às últimas funcionalidades"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{onClick:n,disabled:s,className:"bg-white text-blue-600 hover:bg-white/90",size:"sm",children:s?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Atualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Atualizar"]})}),e.jsx(F,{variant:"ghost",size:"sm",onClick:o,className:"text-white hover:bg-white/20",children:e.jsx(O,{className:"w-4 h-4"})})]})]})})})}):null}const re=r.createContext({user:null,loading:!0,signInWithGoogle:async()=>{},signOut:async()=>{},refreshProfile:async()=>{},signInOffline:async()=>{},updateAvatar:async()=>{}}),ne=()=>r.useContext(re);function oe({children:t}){const[s,n]=r.useState(null),[o,i]=r.useState(!0);r.useEffect(()=>{let e=!0;(async()=>{try{const s=localStorage.getItem("offline_user");if(s&&e)try{const e=JSON.parse(s);e.group_id||(e.group_id=`group_${e.id.slice(-8)}`,localStorage.setItem("offline_user",JSON.stringify(e))),n(e)}catch(t){}else e&&n(null)}catch(t){}finally{e&&i(!1)}})();return(async()=>{})(),()=>{e=!1}},[]);return e.jsx(re.Provider,{value:{user:s,loading:o,signInWithGoogle:async()=>{alert("Google OAuth foi removido. Use a autenticação offline.")},signOut:async()=>{try{localStorage.removeItem("offline_user"),localStorage.removeItem("user_data"),localStorage.removeItem("player_data"),sessionStorage.clear(),n(null)}catch(e){throw e}},refreshProfile:async()=>{try{const e=localStorage.getItem("offline_user");if(e){const t=JSON.parse(e);n(t)}}catch(e){}},signInOffline:async(e,t)=>{try{const t="offline-"+Date.now(),s={id:t,email:e,name:e.split("@")[0],role:"owner",group_id:`group_${t.slice(-8)}`};localStorage.setItem("offline_user",JSON.stringify(s)),n(s)}catch(s){throw s}},updateAvatar:async e=>{try{if(s){const t={...s,custom_avatar:e};localStorage.setItem("offline_user",JSON.stringify(t)),n(t)}}catch(t){throw t}}},children:t})}const ie=r.createContext({theme:"light",setTheme:()=>{},isDark:!1}),ae=()=>r.useContext(ie);function ce({children:t}){const s=()=>{if("undefined"!=typeof window){return localStorage.getItem("theme")||"light"}return"light"},[n,o]=r.useState(s),[i,a]=r.useState(()=>{if("undefined"!=typeof window){const e=localStorage.getItem("theme");if("dark"===e)return!0;if("light"===e)return!1;if("auto"===e)return window.matchMedia("(prefers-color-scheme: dark)").matches}return!1});return r.useEffect(()=>{const e=document.documentElement,t=s();if("auto"===t){window.matchMedia("(prefers-color-scheme: dark)").matches?e.classList.add("dark"):e.classList.remove("dark")}else"dark"===t?e.classList.add("dark"):e.classList.remove("dark")},[]),r.useEffect(()=>{const e=document.documentElement;if("auto"===n){const t=window.matchMedia("(prefers-color-scheme: dark)").matches;a(t),t?e.classList.add("dark"):e.classList.remove("dark")}else"dark"===n?(a(!0),e.classList.add("dark")):(a(!1),e.classList.remove("dark"));localStorage.setItem("theme",n)},[n]),r.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{if("auto"===n){const t=e.matches;a(t),t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[n]),e.jsx(ie.Provider,{value:{theme:n,setTheme:o,isDark:i},children:t})}function le(){const t=o(),{pathname:s}=i();ne();const{isDark:r}=ae();if("/"===s||"/login"===s)return null;const n=[{href:"/home",label:"Jogos",icon:C},{href:"/match",label:"Partida",icon:_},{href:"/ranking",label:"Ranking",icon:x},{href:"/perfil",label:"Perfil",icon:I}],a=n.some(e=>s===e.href);return e.jsx("nav",{className:`\n      fixed bottom-0 left-0 right-0 z-50 backdrop-blur-md border-t shadow-xl transition-colors duration-300\n      ${r?"bg-black/95 border-green-500":"bg-white/95 border-green-500"}\n    `,children:e.jsx("div",{className:"max-w-4xl mx-auto px-3",children:e.jsx("div",{className:"flex items-center py-3 "+(a?"justify-center":"justify-around"),children:n.map((n,o)=>{const i=s===n.href,a=n.icon;return e.jsxs("button",{onClick:()=>(e=>{try{t(e)}catch(s){try{window.location.href=e}catch(r){}}})(n.href,n.label),className:`\n                  group relative flex items-center transition-all duration-500 ease-out\n                  ${i?"bg-green-500 text-white rounded-xl px-4 py-3 shadow-lg":r?"text-gray-300 hover:bg-gray-800 rounded-full p-3 mx-1":"text-gray-600 hover:bg-gray-100 rounded-full p-3 mx-1"}\n                  transform hover:scale-105 active:scale-95\n                `,style:{animationDelay:100*o+"ms",width:i?"auto":"48px",minWidth:i?"120px":"48px"},children:[i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500 to-green-600 rounded-xl opacity-90 animate-pulse"}),e.jsxs("div",{className:"relative z-10 flex items-center",children:[e.jsx(a,{className:`\n                    transition-all duration-500 ease-out flex-shrink-0\n                    ${i?"w-6 h-6 text-white":r?"w-6 h-6 text-gray-300 group-hover:text-green-400":"w-6 h-6 text-gray-600 group-hover:text-green-500"}\n                  `}),e.jsx("span",{className:`\n                    font-medium transition-all duration-500 ease-out overflow-hidden\n                    ${i?"ml-3 opacity-100 max-w-xs":"ml-0 opacity-0 max-w-0"}\n                    whitespace-nowrap\n                  `,children:n.label})]})]},n.href)})})})})}for(var ue=[],he=[],de=Uint8Array,fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ge=0;ge<64;++ge)ue[ge]=fe[ge],he[fe.charCodeAt(ge)]=ge;function me(e){var t,s,r=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");return-1===s&&(s=t),[s,s===t?0:4-s%4]}(e),n=r[0],o=r[1],i=new de(function(e,t,s){return 3*(t+s)/4-s}(0,n,o)),a=0,c=o>0?n-4:n;for(s=0;s<c;s+=4)t=he[e.charCodeAt(s)]<<18|he[e.charCodeAt(s+1)]<<12|he[e.charCodeAt(s+2)]<<6|he[e.charCodeAt(s+3)],i[a++]=t>>16&255,i[a++]=t>>8&255,i[a++]=255&t;return 2===o&&(t=he[e.charCodeAt(s)]<<2|he[e.charCodeAt(s+1)]>>4,i[a++]=255&t),1===o&&(t=he[e.charCodeAt(s)]<<10|he[e.charCodeAt(s+1)]<<4|he[e.charCodeAt(s+2)]>>2,i[a++]=t>>8&255,i[a++]=255&t),i}function pe(e){return ue[e>>18&63]+ue[e>>12&63]+ue[e>>6&63]+ue[63&e]}function ye(e,t,s){for(var r,n=[],o=t;o<s;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),n.push(pe(r));return n.join("")}function ve(e){for(var t,s=e.length,r=s%3,n=[],o=16383,i=0,a=s-r;i<a;i+=o)n.push(ye(e,i,i+o>a?a:i+o));return 1===r?(t=e[s-1],n.push(ue[t>>2]+ue[t<<4&63]+"==")):2===r&&(t=(e[s-2]<<8)+e[s-1],n.push(ue[t>>10]+ue[t>>4&63]+ue[t<<2&63]+"=")),n.join("")}function be(e){if(void 0===e)return{};if(!we(e))throw new Error(`The arguments to a Convex function must be an object. Received: ${e}`);return e}function we(e){const t="object"==typeof e,s=Object.getPrototypeOf(e),r=null===s||s===Object.prototype||"Object"===s?.constructor?.name;return t&&r}he["-".charCodeAt(0)]=62,he["_".charCodeAt(0)]=63;const xe=!0,ke=BigInt("-9223372036854775808"),Se=BigInt("9223372036854775807"),je=BigInt("0"),Ce=BigInt("8"),Re=BigInt("256");function Ae(e){return Number.isNaN(e)||!Number.isFinite(e)||Object.is(e,-0)}const Te=DataView.prototype.setBigInt64?function(e){if(e<ke||Se<e)throw new Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);const t=new ArrayBuffer(8);return new DataView(t).setBigInt64(0,e,!0),ve(new Uint8Array(t))}:function(e){e<je&&(e-=ke+ke);let t=e.toString(16);t.length%2==1&&(t="0"+t);const s=new Uint8Array(new ArrayBuffer(8));let r=0;for(const n of t.match(/.{2}/g).reverse())s.set([parseInt(n,16)],r++),e>>=Ce;return ve(s)},Ee=DataView.prototype.getBigInt64?function(e){const t=me(e);if(8!==t.byteLength)throw new Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);return new DataView(t.buffer).getBigInt64(0,!0)}:function(e){const t=me(e);if(8!==t.byteLength)throw new Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let s=je,r=je;for(const n of t)s+=BigInt(n)*Re**r,r++;return s>Se&&(s+=ke+ke),s};function qe(e){if(e.length>1024)throw new Error(`Field name ${e} exceeds maximum field name length 1024.`);if(e.startsWith("$"))throw new Error(`Field name ${e} starts with a '$', which is reserved.`);for(let t=0;t<e.length;t+=1){const s=e.charCodeAt(t);if(s<32||s>=127)throw new Error(`Field name ${e} has invalid character '${e[t]}': Field names can only contain non-control ASCII characters`)}}function Me(e){if(null===e)return e;if("boolean"==typeof e)return e;if("number"==typeof e)return e;if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>Me(e));if("object"!=typeof e)throw new Error(`Unexpected type of ${e}`);const t=Object.entries(e);if(1===t.length){const s=t[0][0];if("$bytes"===s){if("string"!=typeof e.$bytes)throw new Error(`Malformed $bytes field on ${e}`);return me(e.$bytes).buffer}if("$integer"===s){if("string"!=typeof e.$integer)throw new Error(`Malformed $integer field on ${e}`);return Ee(e.$integer)}if("$float"===s){if("string"!=typeof e.$float)throw new Error(`Malformed $float field on ${e}`);const t=me(e.$float);if(8!==t.byteLength)throw new Error(`Received ${t.byteLength} bytes, expected 8 for $float`);const s=new DataView(t.buffer).getFloat64(0,xe);if(!Ae(s))throw new Error(`Float ${s} should be encoded as a number`);return s}if("$set"===s)throw new Error("Received a Set which is no longer supported as a Convex type.");if("$map"===s)throw new Error("Received a Map which is no longer supported as a Convex type.")}const s={};for(const[r,n]of Object.entries(e))qe(r),s[r]=Me(n);return s}function _e(e){return JSON.stringify(e,(e,t)=>void 0===t?"undefined":"bigint"==typeof t?`${t.toString()}n`:t)}function Ie(e,t,s,r){if(void 0===e){const e=s&&` (present at path ${s} in original object ${_e(t)})`;throw new Error(`undefined is not a valid Convex value${e}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(null===e)return e;if("bigint"==typeof e){if(e<ke||Se<e)throw new Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);return{$integer:Te(e)}}if("number"==typeof e){if(Ae(e)){const t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,xe),{$float:ve(new Uint8Array(t))}}return e}if("boolean"==typeof e)return e;if("string"==typeof e)return e;if(e instanceof ArrayBuffer)return{$bytes:ve(new Uint8Array(e))};if(Array.isArray(e))return e.map((e,r)=>Ie(e,t,s+`[${r}]`));if(e instanceof Set)throw new Error(Ne(s,"Set",[...e],t));if(e instanceof Map)throw new Error(Ne(s,"Map",[...e],t));if(!we(e)){const r=e?.constructor?.name;throw new Error(Ne(s,r?`${r} `:"",e,t))}const n={},o=Object.entries(e);o.sort(([e,t],[s,r])=>e===s?0:e<s?-1:1);for(const[i,a]of o)void 0!==a&&(qe(i),n[i]=Ie(a,t,s+`.${i}`));return n}function Ne(e,t,s,r){return e?`${t}${_e(s)} is not a supported Convex type (present at path ${e} in original object ${_e(r)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${t}${_e(s)} is not a supported Convex type.`}function Oe(e){return Ie(e,e,"")}var Le,Pe,$e=Object.defineProperty,Ve=(e,t,s)=>((e,t,s)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);const Qe=Symbol.for("ConvexError");class De extends(Pe=Error,Le=Qe,Pe){constructor(e){super("string"==typeof e?e:_e(e)),Ve(this,"name","ConvexError"),Ve(this,"data"),Ve(this,Le,!0),this.data=e}}const Fe=()=>Array.from({length:4},()=>0);Fe(),Fe();const ze="1.27.3";var Ue=Object.defineProperty,We=(e,t,s)=>((e,t,s)=>t in e?Ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);function Be(e){switch(e){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class Je{constructor(e){We(this,"_onLogLineFuncs"),We(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let s=0;s<10&&void 0!==this._onLogLineFuncs[t];s++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(const t of Object.values(this._onLogLineFuncs))t("debug",`${(new Date).toISOString()}`,...e)}log(...e){for(const t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(const t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(const t of Object.values(this._onLogLineFuncs))t("error",...e)}}function He(e){const t=new Je(e);return t.addLogLineListener((e,...t)=>{e}),t}function Ge(e){return new Je(e)}function Xe(e,t,s,r,n){const o=Be(s);if("object"==typeof n&&(n=`ConvexError ${JSON.stringify(n.errorData,null,2)}`),"info"===t){const t=n.match(/^\[.*?\] /);if(null===t)return void e.error(`[CONVEX ${o}(${r})] Could not parse console.log`);const s=n.slice(1,t[0].length-2),i=n.slice(t[0].length);e.log(`%c[CONVEX ${o}(${r})] [${s}]`,"color:rgb(0, 145, 255)",i)}else e.error(`[CONVEX ${o}(${r})] ${n}`)}function Ze(e,t,s){return`[CONVEX ${Be(e)}(${t})] ${s.errorMessage}\n  Called by client`}function Ke(e,t){return t.data=e.errorData,t}function Ye(e){const t=e.split(":");let s,r;return 1===t.length?(s=t[0],r="default"):(s=t.slice(0,t.length-1).join(":"),r=t[t.length-1]),s.endsWith(".js")&&(s=s.slice(0,-3)),`${s}:${r}`}function et(e,t){return JSON.stringify({udfPath:Ye(e),args:Oe(t)})}var tt=Object.defineProperty,st=(e,t,s)=>((e,t,s)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class rt{constructor(){st(this,"nextQueryId"),st(this,"querySetVersion"),st(this,"querySet"),st(this,"queryIdToToken"),st(this,"identityVersion"),st(this,"auth"),st(this,"outstandingQueriesOlderThanRestart"),st(this,"outstandingAuthOlderThanRestart"),st(this,"paused"),st(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return 0===this.outstandingQueriesOlderThanRestart.size&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,s,r){const n=Ye(e),o=et(n,t),i=this.querySet.get(o);if(void 0!==i)return i.numSubscribers+=1,{queryToken:o,modification:null,unsubscribe:()=>this.removeSubscriber(o)};{const e=this.nextQueryId++,i={id:e,canonicalizedUdfPath:n,args:t,numSubscribers:1,journal:s,componentPath:r};this.querySet.set(o,i),this.queryIdToToken.set(e,o);const a=this.querySetVersion,c=this.querySetVersion+1,l={type:"Add",queryId:e,udfPath:n,args:[Oe(t)],journal:s,componentPath:r};this.paused?this.pendingQuerySetModifications.set(e,l):this.querySetVersion=c;return{queryToken:o,modification:{type:"ModifyQuerySet",baseVersion:a,newVersion:c,modifications:[l]},unsubscribe:()=>this.removeSubscriber(o)}}}transition(e){for(const t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);const e=t.journal;if(void 0!==e){const s=this.queryIdToToken.get(t.queryId);void 0!==s&&(this.querySet.get(s).journal=e)}break}case"QueryRemoved":this.outstandingQueriesOlderThanRestart.delete(t.queryId);break;default:throw new Error(`Invalid modification ${t.type}`)}}queryId(e,t){const s=et(Ye(e),t),r=this.querySet.get(s);return void 0!==r?r.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}setAuth(e){this.auth={tokenType:"User",value:e};const t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){const s={tokenType:"Admin",value:e,impersonating:t};this.auth=s;const r=this.identityVersion;return this.paused||(this.identityVersion=r+1),{type:"Authenticate",baseVersion:r,...s}}clearAuth(){this.auth=void 0,this.markAuthCompletion();const e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){const t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){const t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();const t=[];for(const n of this.querySet.values()){const s={type:"Add",queryId:n.id,udfPath:n.canonicalizedUdfPath,args:[Oe(n.args)],journal:n.journal,componentPath:n.componentPath};t.push(s),e.has(n.id)||this.outstandingQueriesOlderThanRestart.add(n.id)}this.querySetVersion=1;const s={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[s,void 0];this.outstandingAuthOlderThanRestart=!0;const r={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[s,r]}pause(){this.paused=!0}resume(){const e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=void 0!==this.auth?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){const t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);const s=this.querySetVersion,r=this.querySetVersion+1,n={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,n):this.querySetVersion=r,{type:"ModifyQuerySet",baseVersion:s,newVersion:r,modifications:[n]}}}}var nt=Object.defineProperty,ot=(e,t,s)=>((e,t,s)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class it{constructor(e,t){this.logger=e,this.markConnectionStateDirty=t,ot(this,"inflightRequests"),ot(this,"requestsOlderThanRestart"),ot(this,"inflightMutationsCount",0),ot(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){const s=new Promise(s=>{const r=t?"Requested":"NotSent";this.inflightRequests.set(e.requestId,{message:e,status:{status:r,requestedAt:new Date,onResult:s}}),"Mutation"===e.type?this.inflightMutationsCount++:"Action"===e.type&&this.inflightActionsCount++});return this.markConnectionStateDirty(),s}onResponse(e){const t=this.inflightRequests.get(e.requestId);if(void 0===t)return null;if("Completed"===t.status.status)return null;const s="Mutation"===t.message.type?"mutation":"action",r=t.message.udfPath;for(const a of e.logLines)Xe(this.logger,"info",s,r,a);const n=t.status;let o,i;if(e.success)o={success:!0,logLines:e.logLines,value:Me(e.result)},i=()=>n.onResult(o);else{const t=e.result,{errorData:a}=e;Xe(this.logger,"error",s,r,t),o={success:!1,errorMessage:t,errorData:void 0!==a?Me(a):void 0,logLines:e.logLines},i=()=>n.onResult(o)}return"ActionResponse"!==e.type&&e.success?(t.status={status:"Completed",result:o,ts:e.ts,onResolve:i},null):(i(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),"Action"===t.message.type?this.inflightActionsCount--:"Mutation"===t.message.type&&this.inflightMutationsCount--,this.markConnectionStateDirty(),{requestId:e.requestId,result:o})}removeCompleted(e){const t=new Map;for(const[s,r]of this.inflightRequests.entries()){const n=r.status;"Completed"===n.status&&n.ts.lessThanOrEqual(e)&&(n.onResolve(),t.set(s,n.result),"Mutation"===r.message.type?this.inflightMutationsCount--:"Action"===r.message.type&&this.inflightActionsCount--,this.inflightRequests.delete(s),this.requestsOlderThanRestart.delete(s))}return t.size>0&&this.markConnectionStateDirty(),t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());const e=[];for(const[t,s]of this.inflightRequests)if("NotSent"!==s.status.status){if("Mutation"===s.message.type)e.push(s.message);else if("Action"===s.message.type){if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),this.inflightActionsCount--,"Completed"===s.status.status)throw new Error("Action should never be in 'Completed' state");s.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}else s.status.status="Requested",e.push(s.message);return this.markConnectionStateDirty(),e}resume(){const e=[];for(const[,t]of this.inflightRequests)"NotSent"!==t.status.status||(t.status.status="Requested",e.push(t.message));return e}hasIncompleteRequests(){for(const e of this.inflightRequests.values())if("Requested"===e.status.status)return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return 0===this.requestsOlderThanRestart.size}timeOfOldestInflightRequest(){if(0===this.inflightRequests.size)return null;let e=Date.now();for(const t of this.inflightRequests.values())"Completed"!==t.status.status&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}}const at=Symbol.for("functionName"),ct=Symbol.for("toReferencePath");function lt(e){let t;if("string"==typeof e)t=e.startsWith("function://")?{functionHandle:e}:{name:e};else if(e[at])t={name:e[at]};else{const s=e[ct]??null;if(!s)throw new Error(`${e} is not a functionReference`);t={reference:s}}return t}function ut(e){const t=lt(e);if(void 0===t.name){if(void 0!==t.functionHandle)throw new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${t.functionHandle}`);if(void 0!==t.reference)throw new Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${t.reference}`);throw new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(t)}`)}if("string"==typeof e)return e;const s=e[at];if(!s)throw new Error(`${e} is not a functionReference`);return s}function ht(e){return{[at]:e}}const dt=function e(t=[]){return new Proxy({},{get(s,r){if("string"==typeof r){return e([...t,r])}if(r===at){if(t.length<2){const e=["api",...t].join(".");throw new Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${e}\``)}const e=t.slice(0,-1).join("/"),s=t[t.length-1];return"default"===s?e:e+":"+s}return r===Symbol.toStringTag?"FunctionReference":void 0}})}();var ft=Object.defineProperty,gt=(e,t,s)=>((e,t,s)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class mt{constructor(e){gt(this,"queryResults"),gt(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){const s=be(t[0]),r=ut(e),n=this.queryResults.get(et(r,s));if(void 0!==n)return mt.queryValue(n.result)}getAllQueries(e){const t=[],s=ut(e);for(const r of this.queryResults.values())r.udfPath===Ye(s)&&t.push({args:r.args,value:mt.queryValue(r.result)});return t}setQuery(e,t,s){const r=be(t),n=ut(e),o=et(n,r);let i;i=void 0===s?void 0:{success:!0,value:s,logLines:[]};const a={udfPath:n,args:r,result:i};this.queryResults.set(o,a),this.modifiedQueries.push(o)}static queryValue(e){return void 0===e?void 0:e.success?e.value:void 0}}class pt{constructor(){gt(this,"queryResults"),gt(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(e=>!t.has(e.mutationId));const s=this.queryResults;this.queryResults=new Map(e);const r=new mt(this.queryResults);for(const o of this.optimisticUpdates)o.update(r);const n=[];for(const[o,i]of this.queryResults){const e=s.get(o);void 0!==e&&e.result===i.result||n.push(o)}return n}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});const s=new mt(this.queryResults);return e(s),s.modifiedQueries}rawQueryResult(e){return this.queryResults.get(e)}queryResult(e){const t=this.queryResults.get(e);if(void 0===t)return;const s=t.result;if(void 0!==s){if(s.success)return s.value;if(void 0!==s.errorData)throw Ke(s,new De(Ze("query",t.udfPath,s)));throw new Error(Ze("query",t.udfPath,s))}}hasQueryResult(e){return void 0!==this.queryResults.get(e)}queryLogs(e){const t=this.queryResults.get(e);return t?.result?.logLines}}var yt=Object.defineProperty,vt=(e,t,s)=>((e,t,s)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class bt{constructor(e,t){vt(this,"low"),vt(this,"high"),vt(this,"__isUnsignedLong__"),this.low=0|e,this.high=0|t,this.__isUnsignedLong__=!0}static isLong(e){return!0===(e&&e.__isUnsignedLong__)}static fromBytesLE(e){return new bt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){const e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?wt:e>=kt?St:new bt(e%xt|0,e/xt|0)}toString(){return(BigInt(this.high)*BigInt(xt)+BigInt(this.low)).toString()}equals(e){return bt.isLong(e)||(e=bt.fromValue(e)),(this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)}notEquals(e){return!this.equals(e)}comp(e){return bt.isLong(e)||(e=bt.fromValue(e)),this.equals(e)?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return this.comp(e)<=0}static fromValue(e){return"number"==typeof e?bt.fromNumber(e):new bt(e.low,e.high)}}const wt=new bt(0,0),xt=4294967296,kt=xt*xt,St=new bt(-1,-1);var jt=Object.defineProperty,Ct=(e,t,s)=>((e,t,s)=>t in e?jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class Rt{constructor(e,t){Ct(this,"version"),Ct(this,"remoteQuerySet"),Ct(this,"queryPath"),Ct(this,"logger"),this.version={querySet:0,ts:bt.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){const t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw new Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}`);for(const s of e.modifications)switch(s.type){case"QueryUpdated":{const e=this.queryPath(s.queryId);if(e)for(const r of s.logLines)Xe(this.logger,"info","query",e,r);const t=Me(s.value??null);this.remoteQuerySet.set(s.queryId,{success:!0,value:t,logLines:s.logLines});break}case"QueryFailed":{const e=this.queryPath(s.queryId);if(e)for(const r of s.logLines)Xe(this.logger,"info","query",e,r);const{errorData:t}=s;this.remoteQuerySet.set(s.queryId,{success:!1,errorMessage:s.errorMessage,errorData:void 0!==t?Me(t):void 0,logLines:s.logLines});break}case"QueryRemoved":this.remoteQuerySet.delete(s.queryId);break;default:throw new Error(`Invalid modification ${s.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}function At(e){const t=me(e);return bt.fromBytesLE(Array.from(t))}var Tt=Object.defineProperty,Et=(e,t,s)=>((e,t,s)=>t in e?Tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);let qt;function Mt(){return void 0===qt&&(qt=Date.now()),"undefined"!=typeof performance&&performance.now?Math.round(qt+performance.now()):Date.now()}function _t(){return`t=${Math.round((Mt()-qt)/100)/10}s`}const It={InternalServerError:{timeout:1e3},SubscriptionsWorkerFullError:{timeout:3e3},TooManyConcurrentRequests:{timeout:3e3},CommitterFullError:{timeout:3e3},AwsTooManyRequestsException:{timeout:3e3},ExecuteFullError:{timeout:3e3},SystemTimeoutError:{timeout:3e3},ExpiredInQueue:{timeout:3e3},VectorIndexesUnavailable:{timeout:1e3},SearchIndexesUnavailable:{timeout:1e3},TableSummariesUnavailable:{timeout:1e3},VectorIndexTooLarge:{timeout:3e3},SearchIndexTooLarge:{timeout:3e3},TooManyWritesInTimePeriod:{timeout:3e3}};class Nt{constructor(e,t,s,r,n,o){this.markConnectionStateDirty=n,this.debug=o,Et(this,"socket"),Et(this,"connectionCount"),Et(this,"_hasEverConnected",!1),Et(this,"lastCloseReason"),Et(this,"defaultInitialBackoff"),Et(this,"maxBackoff"),Et(this,"retries"),Et(this,"serverInactivityThreshold"),Et(this,"reconnectDueToServerInactivityTimeout"),Et(this,"uri"),Et(this,"onOpen"),Et(this,"onResume"),Et(this,"onMessage"),Et(this,"webSocketConstructor"),Et(this,"logger"),Et(this,"onServerDisconnectError"),this.webSocketConstructor=s,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.defaultInitialBackoff=1e3,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=6e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.onServerDisconnectError=t.onServerDisconnectError,this.logger=r,this.connect()}setSocketState(e){this.socket=e,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`),this.markConnectionStateDirty()}connect(){if("terminated"===this.socket.state)return;if("disconnected"!==this.socket.state&&"stopped"!==this.socket.state)throw new Error("Didn't start connection from disconnected state: "+this.socket.state);const e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:e,paused:"no"}),this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),"connecting"!==this.socket.state)throw new Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:e,paused:"yes"===this.socket.paused?"uninitialized":"no"}),this.resetServerInactivityTimeout(),"no"===this.socket.paused&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:Mt()})),"InitialConnect"!==this.lastCloseReason&&(this.lastCloseReason?this.logger.log("WebSocket reconnected at",_t(),"after disconnect due to",this.lastCloseReason):this.logger.log("WebSocket reconnected at",_t())),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=e=>{const t=e.message;t&&this.logger.log(`WebSocket error message: ${t}`)},e.onmessage=e=>{this.resetServerInactivityTimeout();const t=e.data.length,s=function(e){switch(e.type){case"FatalError":case"AuthError":case"ActionResponse":case"Ping":return{...e};case"MutationResponse":return e.success?{...e,ts:At(e.ts)}:{...e};case"Transition":return{...e,startVersion:{...e.startVersion,ts:At(e.startVersion.ts)},endVersion:{...e.endVersion,ts:At(e.endVersion.ts)}}}}(JSON.parse(e.data));this._logVerbose(`received ws message with type ${s.type}`),"Transition"===s.type&&this.reportLargeTransition({messageLength:t,transition:s});this.onMessage(s).hasSyncedPastLastReconnect&&(this.retries=0,this.markConnectionStateDirty())},e.onclose=e=>{if(this._logVerbose("begin ws.onclose"),null===this.lastCloseReason&&(this.lastCloseReason=e.reason||`closed with code ${e.code}`),1e3!==e.code&&1001!==e.code&&1005!==e.code&&4040!==e.code){let t=`WebSocket closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.logger.log(t),this.onServerDisconnectError&&e.reason&&this.onServerDisconnectError(t)}const t=function(e){if(void 0===e)return"Unknown";for(const t of Object.keys(It))if(e.startsWith(t))return t;return"Unknown"}(e.reason);this.scheduleReconnect(t)}}socketState(){return this.socket.state}sendMessage(e){const t={type:e.type,..."Authenticate"===e.type&&"User"===e.tokenType?{value:`...${e.value.slice(-7)}`}:{}};if("ready"===this.socket.state&&"no"===this.socket.paused){const r=function(e){switch(e.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...e};case"Connect":return void 0!==e.maxObservedTimestamp?{...e,maxObservedTimestamp:(t=e.maxObservedTimestamp,ve(new Uint8Array(t.toBytesLE())))}:{...e,maxObservedTimestamp:void 0}}var t}(e),n=JSON.stringify(r);let o=!1;try{this.socket.ws.send(n),o=!0}catch(s){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${s}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`${o?"sent":"failed to send"} message with type ${e.type}: ${JSON.stringify(t)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(t)}`),!1}resetServerInactivityTimeout(){"terminated"!==this.socket.state&&(null!==this.reconnectDueToServerInactivityTimeout&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(e){this.socket={state:"disconnected"};const t=this.nextBackoff(e);this.markConnectionStateDirty(),this.logger.log(`Attempting reconnect in ${Math.round(t)}ms`),setTimeout(()=>this.connect(),t)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":return this.lastCloseReason=e,this.close(),void this.scheduleReconnect("client");default:this.socket}}close(){switch(this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{const e=this.socket.ws;return new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");const e=this.socket.ws,t=new Promise(t=>{e.onclose=()=>{t()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{const e=this.close();return this.setSocketState({state:"terminated"}),e}default:throw this.socket,new Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{const e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":return void this.logger.logVerbose("Restart called without stopping first");default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":return void(this.socket={...this.socket,paused:"yes"});default:return void this.socket}}resume(){switch(this.socket.state){case"connecting":return void(this.socket={...this.socket,paused:"no"});case"ready":return void("uninitialized"===this.socket.paused?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:Mt()})):"yes"===this.socket.paused&&(this.socket={...this.socket,paused:"no"},this.onResume()));case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:"ready"===this.socket.state,hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(e){const t=("client"===e?100:"Unknown"===e?this.defaultInitialBackoff:It[e].timeout)*Math.pow(2,this.retries);this.retries+=1;const s=Math.min(t,this.maxBackoff);return s+s*(Math.random()-.5)}reportLargeTransition({transition:e,messageLength:t}){if(void 0===e.clientClockSkew||void 0===e.serverTs)return;const s=Mt()-e.clientClockSkew-e.serverTs/1e6,r=`${Math.round(s)}ms`,n=Math.round(t/1e4)/100+"MB",o=t/(s/1e3),i=Math.round(o/1e4)/100+"MB per second";this._logVerbose(`received ${n} transition in ${r} at ${i}`),t>2e7?this.logger.log(`received query results totaling more that 20MB (${n}) which will take a long time to download on slower connections`):s>2e4&&this.logger.log(`received query results totaling ${n} which took more than 20s to arrive (${r})`),this.debug&&s>2e3&&this.sendMessage({type:"Event",eventType:"ClientReceivedTransition",event:{transitionTransitTime:s,messageLength:t}})}}function Ot(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}class Lt extends Error{}function Pt(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(t)}catch(s){return atob(t)}}Lt.prototype.name="InvalidTokenError";var $t=Object.defineProperty,Vt=(e,t,s)=>((e,t,s)=>t in e?$t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class Qt{constructor(e,t,s){Vt(this,"authState",{state:"noAuth"}),Vt(this,"configVersion",0),Vt(this,"syncState"),Vt(this,"authenticate"),Vt(this,"stopSocket"),Vt(this,"tryRestartSocket"),Vt(this,"pauseSocket"),Vt(this,"resumeSocket"),Vt(this,"clearAuth"),Vt(this,"logger"),Vt(this,"refreshTokenLeewaySeconds"),Vt(this,"tokenConfirmationAttempts",0),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.tryRestartSocket=t.tryRestartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=s.logger,this.refreshTokenLeewaySeconds=s.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();const s=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});s.isFromOutdatedConfig||(s.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(s.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity))return"waitingForServerConfirmationOfCachedToken"===this.authState.state?(this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),void this.authState.config.onAuthChange(!0)):void("waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0)))}onAuthError(e){if(!1===e.authUpdateAttempted&&("waitingForServerConfirmationOfFreshToken"===this.authState.state||"waitingForServerConfirmationOfCachedToken"===this.authState.state))return void this._logVerbose("ignoring non-auth token expired error");const{baseVersion:t}=e;this.syncState.isCurrentOrNewerAuthVersion(t+1)?this.tryToReauthenticate(e):this._logVerbose("ignoring auth error for previous auth attempt")}async tryToReauthenticate(e){if(this._logVerbose(`attempting to reauthenticate: ${e.error}`),"noAuth"===this.authState.state||"waitingForServerConfirmationOfFreshToken"===this.authState.state&&this.tokenConfirmationAttempts>=2)return this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),void("noAuth"!==this.authState.state&&this.setAndReportAuthFailed(this.authState.config.onAuthChange));"waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${2-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();const t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:"notRefetching"===this.authState.state||"waitingForScheduledRefetch"===this.authState.state})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if("noAuth"===this.authState.state)return;this._logVerbose("refetching auth token");const e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(e){if("noAuth"===this.authState.state)return;const t=this.decodeToken(e);if(!t)return void this.logger.error("Auth token is not a valid JWT, cannot refetch the token");const{iat:s,exp:r}=t;if(!s||!r)return void this.logger.error("Auth token does not have required fields, cannot refetch the token");const n=r-s;if(n<=2)return void this.logger.error("Auth token does not live long enough, cannot refetch the token");let o=Math.min(1728e6,1e3*(n-this.refreshTokenLeewaySeconds));o<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${n}s`),o=0);const i=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},o);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:i,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${o}ms`)}async fetchTokenAndGuardAgainstRace(e,t){const s=++this.configVersion;this._logVerbose(`fetching token with config version ${s}`);const r=await e(t);return this.configVersion!==s?(this._logVerbose(`stale config version, expected ${s}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:r}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){const t="waitingForServerConfirmationOfFreshToken"===e.state?{hadAuth:e.hadAuth,state:e.state,token:`...${e.token.slice(-7)}`}:{state:e.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(t)}`),e.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0}"waitingForScheduledRefetch"===this.authState.state&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return function(e,t){if("string"!=typeof e)throw new Lt("Invalid token specified: must be a string");t||(t={});const s=!0===t.header?0:1,r=e.split(".")[s];if("string"!=typeof r)throw new Lt(`Invalid token specified: missing part #${s+1}`);let n;try{n=Pt(r)}catch(o){throw new Lt(`Invalid token specified: invalid base64 for part #${s+1} (${o.message})`)}try{return JSON.parse(n)}catch(o){throw new Lt(`Invalid token specified: invalid json for part #${s+1} (${o.message})`)}}(e)}catch(t){return this._logVerbose(`Error decoding token: ${t instanceof Error?t.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}const Dt=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function Ft(e){let t=e.name.slice(6);return t=t.charAt(0).toLowerCase()+t.slice(1),{name:t,startTime:e.startTime}}var zt=Object.defineProperty,Ut=(e,t,s)=>((e,t,s)=>t in e?zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class Wt{constructor(e,t,s){if(Ut(this,"address"),Ut(this,"state"),Ut(this,"requestManager"),Ut(this,"webSocketManager"),Ut(this,"authenticationManager"),Ut(this,"remoteQuerySet"),Ut(this,"optimisticQueryResults"),Ut(this,"_transitionHandlerCounter",0),Ut(this,"_nextRequestId"),Ut(this,"_onTransitionFns",new Map),Ut(this,"_sessionId"),Ut(this,"firstMessageReceived",!1),Ut(this,"debug"),Ut(this,"logger"),Ut(this,"maxObservedTimestamp"),Ut(this,"connectionStateSubscribers",new Map),Ut(this,"nextConnectionStateSubscriberId",0),Ut(this,"_lastPublishedConnectionState"),Ut(this,"markConnectionStateDirty",()=>{Promise.resolve().then(()=>{const e=this.connectionState();if(JSON.stringify(e)!==JSON.stringify(this._lastPublishedConnectionState)){this._lastPublishedConnectionState=e;for(const t of this.connectionStateSubscribers.values())t(e)}})}),Ut(this,"mark",e=>{this.debug&&function(e,t){const s={sessionId:t};"undefined"!=typeof performance&&performance.mark&&performance.mark(e,{detail:s})}(e,this.sessionId)}),"object"==typeof e)throw new Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");!0!==s?.skipConvexDeploymentUrlCheck&&function(e){if(void 0===e)throw new Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if("string"!=typeof e)throw new Error(`Invalid deployment address: found ${e}".`);if(!e.startsWith("http:")&&!e.startsWith("https:"))throw new Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${e}".`);try{new URL(e)}catch{throw new Error(`Invalid deployment address: "${e}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(e.endsWith(".convex.site"))throw new Error(`Invalid deployment address: "${e}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}(e);const r=(s={...s}).authRefreshTokenLeewaySeconds??2;let n=s.webSocketConstructor;if(!n&&"undefined"==typeof WebSocket)throw new Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");n=n||WebSocket,this.debug=s.reportDebugInfoToConvex??!1,this.address=e,this.logger=!1===s.logger?Ge({verbose:s.verbose??!1}):!0!==s.logger&&s.logger?s.logger:He({verbose:s.verbose??!1});const o=e.search("://");if(-1===o)throw new Error("Provided address was not an absolute URL.");const i=e.substring(o+3),a=e.substring(0,o);let c;if("http"===a)c="ws";else{if("https"!==a)throw new Error(`Unknown parent protocol ${a}`);c="wss"}const l=`${c}://${i}/api/${ze}/sync`;this.state=new rt,this.remoteQuerySet=new Rt(e=>this.state.queryPath(e),this.logger),this.requestManager=new it(this.logger,this.markConnectionStateDirty);const u=()=>{this.webSocketManager.pause(),this.state.pause()};this.authenticationManager=new Qt(this.state,{authenticate:e=>{const t=this.state.setAuth(e);return this.webSocketManager.sendMessage(t),t.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:u,resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:r}),this.optimisticQueryResults=new pt,this.addOnTransitionHandler(e=>{t(e.queries.map(e=>e.token))}),this._nextRequestId=0,this._sessionId=Ot();const{unsavedChangesWarning:h}=s;if("undefined"==typeof window||void 0===window.addEventListener){if(!0===h)throw new Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else!1!==h&&window.addEventListener("beforeunload",e=>{if(this.requestManager.hasIncompleteRequests()){e.preventDefault();const t="Are you sure you want to leave? Your changes may not be saved.";return(e||window.event).returnValue=t,t}});this.webSocketManager=new Nt(l,{onOpen:e=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...e,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});const t=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new Rt(e=>this.state.queryPath(e),this.logger);const[s,r]=this.state.restart(t);r&&this.webSocketManager.sendMessage(r),this.webSocketManager.sendMessage(s);for(const n of this.requestManager.restart())this.webSocketManager.sendMessage(n)},onResume:()=>{const[e,t]=this.state.resume();t&&this.webSocketManager.sendMessage(t),e&&this.webSocketManager.sendMessage(e);for(const s of this.requestManager.resume())this.webSocketManager.sendMessage(s)},onMessage:e=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),e.type){case"Transition":{this.observedTimestamp(e.endVersion.ts),this.authenticationManager.onTransition(e),this.remoteQuerySet.transition(e),this.state.transition(e);const t=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(t);break}case"MutationResponse":{e.success&&this.observedTimestamp(e.ts);const t=this.requestManager.onResponse(e);null!==t&&this.notifyOnQueryResultChanges(new Map([[t.requestId,t.result]]));break}case"ActionResponse":this.requestManager.onResponse(e);break;case"AuthError":this.authenticationManager.onAuthError(e);break;case"FatalError":{const t=function(e,t){const s=`[CONVEX FATAL ERROR] ${t}`;return e.error(s),new Error(s)}(this.logger,e.error);throw this.webSocketManager.terminate(),t}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}},onServerDisconnectError:s.onServerDisconnectError},n,this.logger,this.markConnectionStateDirty,this.debug),this.mark("convexClientConstructed"),s.expectAuth&&u()}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(e){(void 0===this.maxObservedTimestamp||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){const t=this.remoteQuerySet.remoteQueryResults(),s=new Map;for(const[n,o]of t){const e=this.state.queryToken(n);if(null!==e){const t={result:o,udfPath:this.state.queryPath(n),args:this.state.queryArgs(n)};s.set(e,t)}}const r=this.optimisticQueryResults.ingestQueryResultsFromServer(s,new Set(e.keys()));this.handleTransition({queries:r.map(e=>({token:e,modification:{kind:"Updated",result:this.optimisticQueryResults.rawQueryResult(e).result}})),reflectedMutations:Array.from(e).map(([e,t])=>({requestId:e,result:t})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(const t of this._onTransitionFns.values())t(e)}addOnTransitionHandler(e){const t=this._transitionHandlerCounter++;return this._onTransitionFns.set(t,e),()=>this._onTransitionFns.delete(t)}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){const s=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(s)}clearAuth(){const e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,s){const r=be(t),{modification:n,queryToken:o,unsubscribe:i}=this.state.subscribe(e,r,s?.journal,s?.componentPath);return null!==n&&this.webSocketManager.sendMessage(n),{queryToken:o,unsubscribe:()=>{const e=i();e&&this.webSocketManager.sendMessage(e)}}}localQueryResult(e,t){const s=et(e,be(t));return this.optimisticQueryResults.queryResult(s)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){const s=et(e,be(t));return this.optimisticQueryResults.queryLogs(s)}queryJournal(e,t){const s=et(e,be(t));return this.state.queryJournal(s)}connectionState(){const e=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:e.isConnected,hasEverConnected:e.hasEverConnected,connectionCount:e.connectionCount,connectionRetries:e.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}subscribeToConnectionState(e){const t=this.nextConnectionStateSubscriberId++;return this.connectionStateSubscribers.set(t,e),()=>{this.connectionStateSubscribers.delete(t)}}async mutation(e,t,s){const r=await this.mutationInternal(e,t,s);if(!r.success){if(void 0!==r.errorData)throw Ke(r,new De(Ze("mutation",e,r)));throw new Error(Ze("mutation",e,r))}return r.value}async mutationInternal(e,t,s,r){const{mutationPromise:n}=this.enqueueMutation(e,t,s,r);return n}enqueueMutation(e,t,s,r){const n=be(t);this.tryReportLongDisconnect();const o=this.nextRequestId;if(this._nextRequestId++,void 0!==s){const e=s.optimisticUpdate;if(void 0!==e){const t=t=>{e(t,n)instanceof Promise&&this.logger.warn("Optimistic update handler returned a Promise. Optimistic updates should be synchronous.")},s=this.optimisticQueryResults.applyOptimisticUpdate(t,o).map(e=>{const t=this.localQueryResultByToken(e);return{token:e,modification:{kind:"Updated",result:void 0===t?void 0:{success:!0,value:t,logLines:[]}}}});this.handleTransition({queries:s,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}const i={type:"Mutation",requestId:o,udfPath:e,componentPath:r,args:[Oe(n)]},a=this.webSocketManager.sendMessage(i);return{requestId:o,mutationPromise:this.requestManager.request(i,a)}}async action(e,t){const s=await this.actionInternal(e,t);if(!s.success){if(void 0!==s.errorData)throw Ke(s,new De(Ze("action",e,s)));throw new Error(Ze("action",e,s))}return s.value}async actionInternal(e,t,s){const r=be(t),n=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();const o={type:"Action",requestId:n,udfPath:e,componentPath:s,args:[Oe(r)]},i=this.webSocketManager.sendMessage(o);return this.requestManager.request(o,i)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){const e=function(e){if("undefined"==typeof performance||!performance.getEntriesByName)return[];const t=[];for(const s of Dt){const r=performance.getEntriesByName(s).filter(e=>"mark"===e.entryType).filter(t=>t.detail.sessionId===e);t.push(...r)}return t.map(Ft)}(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;const e=this.connectionState().timeOfOldestInflightRequest;if(null===e||Date.now()-e.getTime()<=6e4)return;const t=`${this.address}/api/debug_event`;fetch(t,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${ze}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(e=>{e.ok||this.logger.warn("Analytics request failed with response:",e.body)}).catch(e=>{this.logger.warn("Analytics response failed with error:",e)})}}var Bt=Object.defineProperty,Jt=(e,t,s)=>((e,t,s)=>t in e?Bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);if(void 0===n)throw new Error("Required dependency 'react' not found");function Ht(e,t,s){function r(r){return function(e){if("object"==typeof e&&null!==e&&"bubbles"in e&&"persist"in e&&"isDefaultPrevented"in e)throw new Error("Convex function called with SyntheticEvent object. Did you use a Convex function as an event handler directly? Event handlers like onClick receive an event object as their first argument. These SyntheticEvent objects are not valid Convex values. Try wrapping the function like `const handler = () => myMutation();` and using `handler` in the event handler.")}(r),t.mutation(e,r,{optimisticUpdate:s})}return r.withOptimisticUpdate=function(r){if(void 0!==s)throw new Error(`Already specified optimistic update for mutation ${ut(e)}`);return Ht(e,t,r)},r}const Gt=n.createContext(void 0);const Xt=({client:e,children:t})=>n.createElement(Gt.Provider,{value:e},t);function Zt(e,...t){const s="skip"===t[0],n="skip"===t[0]?{}:be(t[0]),o="string"==typeof e?ht(e):e,i=ut(o),a=function(e){const t=r.useContext(Gt);if(void 0===t)throw new Error("Could not find Convex client! `useQuery` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");const s=r.useMemo(()=>(e,s,r)=>t.watchQuery(e,s,r?{journal:r}:{}),[t]);return function(e,t){const[s]=r.useState(()=>new ss(t));s.createWatch!==t&&s.setCreateWatch(t);r.useEffect(()=>()=>s.destroy(),[s]);const n=r.useMemo(()=>({getCurrentValue:()=>s.getLocalResults(e),subscribe:t=>(s.setQueries(e),s.subscribe(t))}),[s,e]);return function({getCurrentValue:e,subscribe:t}){const[s,n]=r.useState(()=>({getCurrentValue:e,subscribe:t,value:e()}));let o=s.value;return s.getCurrentValue===e&&s.subscribe===t||(o=e(),n({getCurrentValue:e,subscribe:t,value:o})),r.useEffect(()=>{let s=!1;const r=()=>{s||n(s=>{if(s.getCurrentValue!==e||s.subscribe!==t)return s;const r=e();return s.value===r?s:{...s,value:r}})},o=t(r);return r(),()=>{s=!0,o()}},[e,t]),o}(n)}(e,s)}(r.useMemo(()=>s?{}:{query:{query:o,args:n}},[JSON.stringify(Oe(n)),i,s])),c=a.query;if(c instanceof Error)throw c;return c}function Kt(e){const t="string"==typeof e?ht(e):e,s=r.useContext(Gt);if(void 0===s)throw new Error("Could not find Convex client! `useMutation` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");return r.useMemo(()=>Ht(t,s),[s,ut(t)])}function Yt(e){const t=r.useContext(Gt),s="string"==typeof e?ht(e):e;if(void 0===t)throw new Error("Could not find Convex client! `useAction` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");return r.useMemo(()=>function(e,t){return function(s){return t.action(e,s)}}(s,t),[t,ut(s)])}var es=Object.defineProperty,ts=(e,t,s)=>((e,t,s)=>t in e?es(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class ss{constructor(e){ts(this,"createWatch"),ts(this,"queries"),ts(this,"listeners"),this.createWatch=e,this.queries={},this.listeners=new Set}setQueries(e){for(const t of Object.keys(e)){const{query:s,args:r}=e[t];if(ut(s),void 0===this.queries[t])this.addQuery(t,s,r);else{const e=this.queries[t];ut(s)===ut(e.query)&&JSON.stringify(Oe(r))===JSON.stringify(Oe(e.args))||(this.removeQuery(t),this.addQuery(t,s,r))}}for(const t of Object.keys(this.queries))void 0===e[t]&&this.removeQuery(t)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}getLocalResults(e){const t={};for(const r of Object.keys(e)){const{query:n,args:o}=e[r];ut(n);const i=this.createWatch(n,o);let a;try{a=i.localQueryResult()}catch(s){if(!(s instanceof Error))throw s;a=s}t[r]=a}return t}setCreateWatch(e){this.createWatch=e;for(const t of Object.keys(this.queries)){const{query:e,args:s,watch:r}=this.queries[t],n=r.journal();this.removeQuery(t),this.addQuery(t,e,s,n)}}destroy(){for(const e of Object.keys(this.queries))this.removeQuery(e);this.listeners=new Set}addQuery(e,t,s,r){if(void 0!==this.queries[e])throw new Error(`Tried to add a new query with identifier ${e} when it already exists.`);const n=this.createWatch(t,s,r),o=n.onUpdate(()=>this.notifyListeners());this.queries[e]={query:t,args:s,watch:n,unsubscribe:o}}removeQuery(e){const t=this.queries[e];if(void 0===t)throw new Error(`No query found with identifier ${e}.`);t.unsubscribe(),delete this.queries[e]}notifyListeners(){for(const e of this.listeners)e()}}const rs=dt;function ns(){try{const e=Zt(rs.managedPlayers.list)||[],t=Kt(rs.managedPlayers.create),s=Kt(rs.managedPlayers.update),r=Kt(rs.managedPlayers.remove),n=Kt(rs.managedPlayers.toggleApproval),o=Kt(rs.managedPlayers.syncProfileToPlayer),i=Kt(rs.managedPlayers.updateProfileFields),a=async e=>{try{return await t({name:e.name,email:e.email,role:e.role,membership:e.membership,position:e.position,stars:e.stars,approved:e.approved,notifications_enabled:e.notifications_enabled})}catch(s){throw s}},c=async e=>{try{await s(e)}catch(t){throw t}},l=async e=>{try{await r({id:e})}catch(t){throw t}},u=async e=>{try{await n({id:e})}catch(t){throw t}},h=async(e,t,s)=>{try{return await o({email:e,name:t,role:s})}catch(r){throw r}},d=async(e,t,s,r)=>{try{return await i({email:e,position:t,shirt_size:s,phone:r})}catch(n){throw n}},f=e.filter(e=>e.approved),g=e.filter(e=>!e.approved),m=t=>e.filter(e=>e.role===t),p=e.filter(e=>e.active),y={total:e.length,approved:f.length,pending:g.length,owners:m("owner").length,admins:m("admin").length,auxiliares:m("aux").length,jogadores:m("player").length,mensalistas:e.filter(e=>"mensalista"===e.membership).length,diaristas:e.filter(e=>"diarista"===e.membership).length};return{players:e,approvedPlayers:f,pendingPlayers:g,activePlayers:p,stats:y,createPlayer:a,updatePlayer:c,removePlayer:l,toggleApproval:u,syncProfileToPlayer:h,updateProfileFields:d,playersByRole:m,isLoading:void 0===e}}catch(e){return{players:[],approvedPlayers:[],pendingPlayers:[],activePlayers:[],stats:{total:0,approved:0,pending:0},createPlayer:async()=>{throw new Error("Convex não disponível")},updatePlayer:async()=>{throw new Error("Convex não disponível")},removePlayer:async()=>{throw new Error("Convex não disponível")},toggleApproval:async()=>{throw new Error("Convex não disponível")},syncProfileToPlayer:async()=>{throw new Error("Convex não disponível")},updateProfileFields:async()=>{throw new Error("Convex não disponível")},playersByRole:()=>({}),isLoading:!1}}}function os(){const{user:e}=ne(),{syncProfileToPlayer:t}=ns();return r.useEffect(()=>{const s=setTimeout(()=>{(async()=>{if(e&&e.email&&e.name)try{const s=e.role;await t(e.email,e.name,s)}catch(s){}})()},1e3);return()=>clearTimeout(s)},[e,t]),null}const is=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),as=n.lazy(()=>h(()=>import("./Home-DRrYElTa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),cs=n.lazy(()=>h(()=>import("./Match-BTMlsU3c.js"),__vite__mapDeps([26,1,2,27,28,20,4,29,30,3,31,16,19,21,13,14,32,33,34,15,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})})));n.lazy(()=>h(()=>import("./Vote-YqiAEZAQ.js"),__vite__mapDeps([35,1,2,13])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})})));const ls=n.lazy(()=>h(()=>import("./InvitesApprovals-DhG3Izh1.js"),__vite__mapDeps([36,1,2,5,30,3,12,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),us=n.lazy(()=>h(()=>import("./Perfil-Ei1bqqC9.js"),__vite__mapDeps([37,1,2,4,38,3,39,22,17,10,12,5,30,7,28,20,21,16,13,14,40,15,6,23,41,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),hs=n.lazy(()=>h(()=>import("./Ranking-MpqNGIkS.js"),__vite__mapDeps([42,1,2,12,27,28,20,16,43,13,15,14,44,24,25,4,5,45,34,32])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),ds=n.lazy(()=>h(()=>import("./OwnerDashboardMobile-DdM_uqu-.js"),__vite__mapDeps([46,1,2,12,4,5,29,31,21,20,13,14,41,17,6,45,18,22,47,40,32,9,48,15,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),fs=n.lazy(()=>h(()=>import("./CreateOwner-NSH4t0u7.js"),__vite__mapDeps([49,1,2,5,29,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),gs=n.lazy(()=>h(()=>import("./CreateOwnerWithGoogle-CwHwEhUn.js"),__vite__mapDeps([50,1,2,51,13,14,15,52,45,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),ms=n.lazy(()=>h(()=>import("./Login-Dmbdsjdl.js"),__vite__mapDeps([53,1,2,54,13,33,55,15,6,8,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),ps=n.lazy(()=>h(()=>import("./callback-Bf-Qli0E.js"),__vite__mapDeps([56,1,2,54,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),ys=n.lazy(()=>h(()=>import("./CreateInvite-DJDd5QnA.js"),__vite__mapDeps([57,1,2,12,5,29,30,3,31,15,23,38,6,39,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),vs=n.lazy(()=>h(()=>import("./AcceptInvite-D4COi_FJ.js"),__vite__mapDeps([58,1,2,13,5,29,30,3,14,9,6,17,38,15,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),bs=n.lazy(()=>h(()=>import("./RestrictedAccess-BiBW0IHv.js"),__vite__mapDeps([43,1,2,12,13,15,14,44,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),ws=n.lazy(()=>h(()=>import("./ManageAdmins-C8bBcyNk.js"),__vite__mapDeps([59,1,2,12,5,51,15,23,6,14,60,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),xs=n.lazy(()=>h(()=>import("./ConfigureAccess-5Xv_d3KM.js"),__vite__mapDeps([61,1,2,29,45,44,15,11,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),ks=n.lazy(()=>h(()=>import("./ApproveParticipants-f2E-mcu7.js"),__vite__mapDeps([62,1,2,12,48,22,6,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),Ss=n.lazy(()=>h(()=>import("./ManagePlayersConvex-DMzQ9Xn1.js"),__vite__mapDeps([63,1,2,12,4,5,29,30,3,51,13,52,18,6,48,60,14,7,15,47,40,32,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),js=n.lazy(()=>h(()=>import("./TeamDrawMobile-ByUbjP-S.js"),__vite__mapDeps([64,1,2,4,29,30,3,19,21,20,13,52,60,23,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),Cs=n.lazy(()=>h(()=>import("./ListUsers-HBmnXLdC.js"),__vite__mapDeps([65,1,2,12,5,6,14,15,34,55,7,38,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),Rs=n.lazy(()=>h(()=>import("./MigratePlayersToConvex-F_UPUxXL.js"),__vite__mapDeps([66,1,2,34,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})}))),As=n.lazy(()=>h(()=>import("./ForceUserSync-CFNd8VFC.js"),__vite__mapDeps([67,1,2,34,13,24,25])).catch(()=>({default:()=>e.jsx("div",{children:"Erro ao carregar página"})})));function Ts(){return((e=!1)=>{const t=r.useCallback((e,t)=>{},[e]);r.useEffect(()=>{if(!e||"undefined"==typeof window)return;const s=()=>{const e=performance.getEntriesByName("first-contentful-paint")[0];e&&t("First Contentful Paint",e.startTime);const s=performance.getEntriesByType("navigation")[0];if(s){const e=s.responseStart-s.requestStart;t("Time to First Byte",e);const r=s.domContentLoadedEventEnd-s.navigationStart;t("DOM Content Loaded",r);const n=s.loadEventEnd-s.navigationStart;t("Load Complete",n)}};if("complete"===document.readyState?s():window.addEventListener("load",s),"PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{const s=e.getEntries(),r=s[s.length-1];r&&t("Largest Contentful Paint",r.startTime)});e.observe({entryTypes:["largest-contentful-paint"]});const s=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{if(e.processingStart&&e.startTime){const s=e.processingStart-e.startTime;t("First Input Delay",s)}})});s.observe({entryTypes:["first-input"]});const r=new PerformanceObserver(e=>{let s=0;e.getEntries().forEach(e=>{e.hadRecentInput||(s+=e.value)}),s>0&&t("Cumulative Layout Shift",1e3*s)});return r.observe({entryTypes:["layout-shift"]}),()=>{e.disconnect(),s.disconnect(),r.disconnect()}}catch(r){}return()=>{window.removeEventListener("load",s)}},[e,t]),r.useCallback((s,r)=>{if(!e)return;const n=performance.now()-r;return t(s,n),n},[e,t]),r.useCallback(()=>performance.now(),[])})(!0),os(),e.jsx(H,{children:e.jsx(ce,{children:e.jsx(X,{children:e.jsx(oe,{children:e.jsxs("div",{className:"min-h-[100dvh] bg-background text-foreground",children:[e.jsx(te,{}),e.jsx(se,{}),e.jsx("div",{className:"mx-auto w-full max-w-full sm:max-w-3xl lg:max-w-4xl pb-20 pt-4",children:e.jsx(r.Suspense,{fallback:e.jsx(is,{}),children:e.jsxs(a,{children:[e.jsx(c,{path:"/",element:e.jsx(ms,{})}),e.jsx(c,{path:"/home",element:e.jsx(as,{})}),e.jsx(c,{path:"/fetch",element:e.jsx(as,{})}),e.jsx(c,{path:"/match",element:e.jsx(cs,{})})," ",e.jsx(c,{path:"/vote",element:e.jsx(l,{to:"/ranking",replace:!0})}),e.jsx(c,{path:"/admin/invites",element:e.jsx(ls,{})}),e.jsx(c,{path:"/ranking",element:e.jsx(hs,{})}),e.jsx(c,{path:"/perfil",element:e.jsx(us,{})}),e.jsx(c,{path:"/owner-dashboard",element:e.jsx(ds,{})}),e.jsx(c,{path:"/create-owner",element:e.jsx(fs,{})}),e.jsx(c,{path:"/create-owner-google",element:e.jsx(gs,{})}),e.jsx(c,{path:"/login",element:e.jsx(ms,{})}),e.jsx(c,{path:"/auth/callback",element:e.jsx(ps,{})}),e.jsx(c,{path:"/create-invite",element:e.jsx(ys,{})}),e.jsx(c,{path:"/accept-invite",element:e.jsx(vs,{})}),e.jsx(c,{path:"/restricted",element:e.jsx(bs,{})}),e.jsx(c,{path:"/manage-admins",element:e.jsx(ws,{})}),e.jsx(c,{path:"/configure-access",element:e.jsx(xs,{})}),e.jsx(c,{path:"/approve-participants",element:e.jsx(ks,{})}),e.jsx(c,{path:"/manage-players",element:e.jsx(Ss,{})}),e.jsx(c,{path:"/migrate-players",element:e.jsx(Rs,{})}),e.jsx(c,{path:"/force-sync",element:e.jsx(As,{})}),e.jsx(c,{path:"/team-draw/:matchId",element:e.jsx(js,{})}),e.jsx(c,{path:"/list-users",element:e.jsx(Cs,{})}),e.jsx(c,{path:"*",element:e.jsx(l,{to:"/",replace:!0})})]})})}),e.jsx(le,{})]})})})})})}const Es=new class{constructor(e,t){if(Jt(this,"address"),Jt(this,"cachedSync"),Jt(this,"listeners"),Jt(this,"options"),Jt(this,"closed",!1),Jt(this,"_logger"),Jt(this,"adminAuth"),Jt(this,"fakeUserIdentity"),void 0===e)throw new Error("No address provided to ConvexReactClient.\nIf trying to deploy to production, make sure to follow all the instructions found at https://docs.convex.dev/production/hosting/\nIf running locally, make sure to run `convex dev` and ensure the .env.local file is populated.");if("string"!=typeof e)throw new Error(`ConvexReactClient requires a URL like 'https://happy-otter-123.convex.cloud', received something of type ${typeof e} instead.`);if(!e.includes("://"))throw new Error("Provided address was not an absolute URL.");this.address=e,this.listeners=new Map,this._logger=!1===t?.logger?Ge({verbose:t?.verbose??!1}):!0!==t?.logger&&t?.logger?t.logger:He({verbose:t?.verbose??!1}),this.options={...t,logger:this._logger}}get url(){return this.address}get sync(){if(this.closed)throw new Error("ConvexReactClient has already been closed.");return this.cachedSync||(this.cachedSync=new Wt(this.address,e=>this.transition(e),this.options),this.adminAuth&&this.cachedSync.setAdminAuth(this.adminAuth,this.fakeUserIdentity)),this.cachedSync}setAuth(e,t){if("string"==typeof e)throw new Error("Passing a string to ConvexReactClient.setAuth is no longer supported, please upgrade to passing in an async function to handle reauthentication.");this.sync.setAuth(e,t??(()=>{}))}clearAuth(){this.sync.clearAuth()}setAdminAuth(e,t){if(this.adminAuth=e,this.fakeUserIdentity=t,this.closed)throw new Error("ConvexReactClient has already been closed.");this.cachedSync&&this.sync.setAdminAuth(e,t)}watchQuery(e,...t){const[s,r]=t,n=ut(e);return{onUpdate:e=>{const{queryToken:t,unsubscribe:o}=this.sync.subscribe(n,s,r),i=this.listeners.get(t);return void 0!==i?i.add(e):this.listeners.set(t,new Set([e])),()=>{if(this.closed)return;const s=this.listeners.get(t);s.delete(e),0===s.size&&this.listeners.delete(t),o()}},localQueryResult:()=>{if(this.cachedSync)return this.cachedSync.localQueryResult(n,s)},localQueryLogs:()=>{if(this.cachedSync)return this.cachedSync.localQueryLogs(n,s)},journal:()=>{if(this.cachedSync)return this.cachedSync.queryJournal(n,s)}}}prewarmQuery(e){const t=e.extendSubscriptionFor??5e3,s=this.watchQuery(e.query,e.args||{}).onUpdate(()=>{});setTimeout(s,t)}mutation(e,...t){const[s,r]=t,n=ut(e);return this.sync.mutation(n,s,r)}action(e,...t){const s=ut(e);return this.sync.action(s,...t)}query(e,...t){const s=this.watchQuery(e,...t),r=s.localQueryResult();return void 0!==r?Promise.resolve(r):new Promise((e,t)=>{const r=s.onUpdate(()=>{r();try{e(s.localQueryResult())}catch(n){t(n)}})})}connectionState(){return this.sync.connectionState()}subscribeToConnectionState(e){return this.sync.subscribeToConnectionState(e)}get logger(){return this._logger}async close(){if(this.closed=!0,this.listeners=new Map,this.cachedSync){const e=this.cachedSync;this.cachedSync=void 0,await e.close()}}transition(e){for(const t of e){const e=this.listeners.get(t);if(e)for(const t of e)t()}}}("https://grateful-spoonbill-350.convex.cloud");function qs({children:t}){return e.jsx(Xt,{client:Es,children:t})}g.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(u,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(qs,{children:e.jsx(Ts,{})})})}));export{F as B,z as C,C as H,A as L,T as R,q as S,_ as T,I as U,N as W,O as X,L as Z,rs as a,Q as b,b as c,U as d,W as e,J as f,ne as g,ns as h,Y as i,S as j,Zt as k,M as l,ae as m,x as n,B as o,k as p,V as q,E as r,Yt as s,Kt as u};
