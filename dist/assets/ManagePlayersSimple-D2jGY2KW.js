import{j as e}from"./vendor-ui-3awKV8G3.js";import{c as s,u as a,B as r,R as i,C as t,b as o,e as l,d as n,S as c}from"./index-Bla-05Lf.js";import{B as d}from"./badge-CsWbohDi.js";import{D as m,a as x,b as h,c as p}from"./dialog-vbKhfTiS.js";import{I as j}from"./input-CZj5AKC-.js";import{L as u}from"./label-B_wgx6W4.js";import{S as g,a as f,b as v,c as N,d as y}from"./select-bkGJLe9M.js";import{r as b}from"./vendor-react-BSMgdr9Q.js";import{u as w}from"./usePermissions-DbRiDohr.js";import{supabase as S}from"./supabase-CqvimHjQ.js";import{U as _}from"./users-DuAXr6n2.js";import{S as E}from"./square-pen-BZEct1w8.js";import{T as A}from"./trash-2-D4KhO66J.js";import"./vendor-router-DHox0sNQ.js";import"./vendor-supabase-D2NKQQk_.js";import"./vendor-utils-CRulVwns.js";import"./check-CzwIeJH4.js";const T=s("Shirt",[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]]);let C=0;const z=new Map,O=e=>{if(z.has(e))return;const s=setTimeout(()=>{z.delete(e),G({type:"REMOVE_TOAST",toastId:e})},1e6);z.set(e,s)},I=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?O(a):e.toasts.forEach(e=>{O(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===s.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},M=[];let D={toasts:[]};function G(e){D=I(D,e),M.forEach(e=>{e(D)})}function J({...e}){const s=(C=(C+1)%Number.MAX_SAFE_INTEGER,C.toString()),a=()=>G({type:"DISMISS_TOAST",toastId:s});return G({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>G({type:"UPDATE_TOAST",toast:{...e,id:s}})}}const U=()=>{const{toast:e}=function(){const[e,s]=b.useState(D);return b.useEffect(()=>(M.push(s),()=>{const e=M.indexOf(s);e>-1&&M.splice(e,1)}),[e]),{...e,toast:J,dismiss:e=>G({type:"DISMISS_TOAST",toastId:e})}}();return{success:(s,a)=>{e({title:s,description:a,variant:"default"})},error:(s,a)=>{e({title:s,description:a,variant:"destructive"})}}},k=()=>{const[s,C]=b.useState([]),[z,O]=b.useState(!0),[I,M]=b.useState(!1),[D,G]=b.useState(null),[J,k]=b.useState({name:"",email:"",role:"diarista",position:"Meia",shirt_size:"G"}),{user:F}=a(),{canManagePlayers:$}=w(),{success:R,error:P}=U(),V=async(e=!1)=>{try{if(z&&!e)return;O(!0);const{data:s,error:a}=await S.from("profiles").select("*").order("updated_at",{ascending:!1});if(a)throw a;if(!s||0===s.length)return C([]),void O(!1);const r=s.map(e=>({id:e.id,name:e.email.split("@")[0]||"Jogador",email:e.email,role:e.role||"player",position:e.position||"Meio",stars:e.stars||5,shirt_size:"G",approved:!0,created_at:e.updated_at}));C(r)}catch(s){P("Erro ao carregar jogadores",s.message),C([])}finally{O(!1)}};b.useEffect(()=>{V()},[]);return!$()&&F?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600",children:"Você não tem permissão para gerenciar jogadores."}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Debug Info:"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["User: ",JSON.stringify(F)]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Can Manage: ",$()?"Yes":"No"]})]})]})}):z?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gerenciar Jogadores"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sistema Híbrido - Funciona offline e online"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{onClick:()=>{k({name:"",email:"",role:"diarista",position:"Meia",shirt_size:"G"}),G(null),M(!0)},className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Adicionar Jogador"]}),e.jsxs(r,{onClick:()=>V(!0),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"Recarregar"]}),e.jsx(r,{onClick:()=>{C([]),setTimeout(()=>V(!0),500)},variant:"outline",className:"flex items-center gap-2",children:"🔄 Forçar Atualização"}),e.jsx(r,{onClick:async()=>{try{const{data:e,error:s}=await S.from("memberships").select("count").limit(1);s?s("Erro de conexão",s.message):R("Conectividade OK","Conexão com Supabase funcionando")}catch(e){P("Erro de rede",e.message)}},variant:"outline",className:"flex items-center gap-2",children:"🔍 Testar Conexão"})]})]}),e.jsxs(t,{children:[e.jsx(o,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Jogadores (",s.length,")"]})}),e.jsx(n,{children:0===s.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum jogador encontrado"}),e.jsx("p",{className:"text-gray-600",children:"Adicione jogadores para começar a gerenciar seu time."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(a=>e.jsx(t,{className:"hover:shadow-md transition-shadow",children:e.jsxs(n,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.email})]}),e.jsx(d,{variant:"secondary",children:a.role})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.stars," estrelas"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsxs("span",{children:["Camisa ",a.shirt_size]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>(e=>{G(e),k({name:e.name,email:e.email,role:e.role,position:e.position,shirt_size:e.shirt_size}),M(!0)})(a),className:"flex-1",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Editar"]}),"michellcosta1269@gmail.com"===a.email?e.jsxs(r,{size:"sm",variant:"outline",disabled:!0,className:"flex-1",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Protegido"]}):e.jsxs(r,{size:"sm",variant:"destructive",onClick:()=>(async(e,a)=>{const r=s.find(s=>s.id===e);if("michellcosta1269@gmail.com"!==r?.email){if(confirm(`Tem certeza que deseja remover ${a}?`))try{const{data:s,error:r}=await S.from("profiles").delete().eq("id",e).select("*");if(r)throw new Error(`Erro ao remover jogador: ${r.message}`);R("Jogador removido",`${a} foi removido com sucesso do Supabase`),await V(!0)}catch(i){P("Erro ao remover jogador",i.message)}}else P("Ação não permitida","O owner principal não pode ser removido")})(a.id,a.name),className:"flex-1",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Remover"]})]})]})},a.id))})})]}),e.jsx(m,{open:I,onOpenChange:M,children:e.jsxs(x,{className:"max-w-md",children:[e.jsx(h,{children:e.jsx(p,{children:D?"Editar Jogador":"Adicionar Jogador"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"name",children:"Nome Completo"}),e.jsx(j,{id:"name",value:J.name,onChange:e=>k(s=>({...s,name:e.target.value})),placeholder:"Nome do jogador"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"email",children:"Email"}),e.jsx(j,{id:"email",type:"email",value:J.email,onChange:e=>k(s=>({...s,email:e.target.value})),placeholder:"email@exemplo.com"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"role",children:"Função"}),"michellcosta1269@gmail.com"===D?.email?e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Owner (Protegido)"}),e.jsx("span",{className:"text-xs text-blue-600",children:"Não pode ser alterado"})]}):e.jsxs(g,{value:J.role,onValueChange:e=>k(s=>({...s,role:e})),children:[e.jsx(f,{children:e.jsx(v,{})}),e.jsxs(N,{children:[e.jsx(y,{value:"admin",children:"Admin"}),e.jsx(y,{value:"auxiliar",children:"Auxiliar"}),e.jsx(y,{value:"mensalista",children:"Mensalista"}),e.jsx(y,{value:"diarista",children:"Diarista"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"position",children:"Posição"}),e.jsxs(g,{value:J.position,onValueChange:e=>k(s=>({...s,position:e})),children:[e.jsx(f,{children:e.jsx(v,{})}),e.jsxs(N,{children:[e.jsx(y,{value:"Goleiro",children:"Goleiro"}),e.jsx(y,{value:"Zagueiro",children:"Zagueiro"}),e.jsx(y,{value:"Meia",children:"Meia"}),e.jsx(y,{value:"Atacante",children:"Atacante"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"shirt_size",children:"Tamanho da Camisa"}),e.jsxs(g,{value:J.shirt_size,onValueChange:e=>k(s=>({...s,shirt_size:e})),children:[e.jsx(f,{children:e.jsx(v,{})}),e.jsxs(N,{children:[e.jsx(y,{value:"G",children:"G"}),e.jsx(y,{value:"GG",children:"GG"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(r,{onClick:()=>{(async()=>{if(J.name&&J.email)try{if(D){"michellcosta1269@gmail.com"===D.email&&(J.role="owner");const e={email:J.email};J.role&&(e.role=J.role),J.position&&(e.position=J.position);const{data:s,error:a}=await S.from("profiles").update(e).eq("id",D.id).select("*");if(a)throw new Error(`Erro ao atualizar profile: ${a.message}`);R("Jogador atualizado",`${J.name} foi atualizado com sucesso no Supabase`),await V(!0)}else try{const a=J.email.trim()||`${J.name.trim()}@exemplo.com`,r=localStorage.getItem("offline_user");let i=null;if(r)try{i=JSON.parse(r)}catch(e){}if(!i)try{const{data:{user:e},error:s}=await S.auth.getUser();e&&!s&&(i={id:e.id,email:e.email,role:"owner"})}catch(e){}if(!i)throw new Error("Usuário não está autenticado. Faça login primeiro.");const t={id:crypto.randomUUID(),email:a,role:J.role||"diarista",membership:"mensalista"===J.role?"mensalista":"diarista",position:J.position||"Meio",stars:5,notifications_enabled:!0},{data:o,error:l}=await S.from("profiles").insert(t).select("*");if(l)try{const{data:e,error:s}=await S.rpc("create_user_profile",{user_id:i.id,user_email:a,user_name:J.name,user_role:J.role||"diarista"});if(s)throw new Error(`Erro ao criar perfil: ${s.message}`)}catch(s){const e={id:crypto.randomUUID(),name:J.name,email:a,role:J.role||"diarista",position:J.position||"Meio",stars:5,shirt_size:J.shirt_size||"G",approved:!0,created_at:(new Date).toISOString(),isTemporary:!0};return C(s=>[e,...s]),void R("Jogador adicionado (temporário)",`${J.name} foi adicionado localmente. Aplique as políticas RLS no Supabase para persistência real.`)}R("Jogador adicionado",`${J.name} foi adicionado com sucesso ao banco de dados`),await V(!0)}catch(a){throw P("Erro ao adicionar jogador",a.message),a}M(!1),G(null)}catch(r){P("Erro ao salvar",r.message)}else P("Campos obrigatórios","Nome e email são obrigatórios")})()},className:"flex-1",children:D?"Atualizar":"Adicionar"}),e.jsx(r,{variant:"outline",onClick:()=>M(!1),children:"Cancelar"})]})]})]})})]})})};export{k as default};
