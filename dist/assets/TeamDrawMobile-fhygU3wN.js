import{j as e}from"./vendor-ui-Bl6_fDik.js";import{B as s,R as a,C as r,a as t,d as i,e as l}from"./index-DBWRIsnn.js";import{D as o,a as n,b as c,c as d,d as m,e as x}from"./dialog-BFatDTMR.js";import{L as h}from"./label-NAFLqNeX.js";import{S as u,a as g,b as p,c as j,d as f}from"./select-DrLdwjNV.js";import{r as b}from"./vendor-react-BSMgdr9Q.js";import{supabase as y}from"./supabase-DgB9yu4v.js";import{u as N}from"./gamesStore-NUrBWBVY.js";import{d as w,u as v}from"./vendor-router-uw2sfKrb.js";import{A as S}from"./arrow-left-CTlJMG_j.js";import{S as _}from"./shuffle-CFkDs7rb.js";import{U as C}from"./user-minus-D6KuJSDo.js";import{U as P}from"./user-plus-6yxTROpn.js";import"./vendor-supabase-5K_8OYiR.js";import"./vendor-utils-CrFdsnXa.js";const T=e=>{const{players:s,loading:a,error:r,getApprovedPlayers:t}=function(){const[e,s]=b.useState([]),[a,r]=b.useState(!1),[t,i]=b.useState(null),l=async()=>{try{r(!0),i(null);const{data:e,error:a}=await y.from("profiles").select("*").order("updated_at",{ascending:!1});if(a)throw a;s(e||[])}catch(e){i(e instanceof Error?e.message:"Erro desconhecido")}finally{r(!1)}};return b.useEffect(()=>{l()},[]),{players:e,loading:a,error:t,loadPlayers:l,createPlayer:async e=>{try{i(null);const{data:s,error:a}=await y.auth.admin.createUser({email:e.email,password:"temp123456",email_confirm:!0});if(a)throw a;const{error:r}=await y.from("profiles").insert({id:s.user.id,...e});if(r)throw r;await l()}catch(s){throw i(s instanceof Error?s.message:"Erro ao criar jogador"),s}},updatePlayer:async(e,s)=>{try{i(null);const{error:a}=await y.from("profiles").update(s).eq("id",e);if(a)throw a;await l()}catch(a){throw i(a instanceof Error?a.message:"Erro ao atualizar jogador"),a}},deletePlayer:async e=>{try{i(null);const{error:s}=await y.auth.admin.deleteUser(e),{error:a}=await y.from("profiles").delete().eq("id",e);if(a)throw a;await l()}catch(s){throw i(s instanceof Error?s.message:"Erro ao excluir jogador"),s}},toggleApproval:async s=>{try{i(null);const a=e.find(e=>e.id===s);if(!a)throw new Error("Jogador não encontrado");const{error:r}=await y.from("profiles").update({approved:!a.approved}).eq("id",s);if(r)throw r;await l()}catch(a){throw i(a instanceof Error?a.message:"Erro ao alterar aprovação"),a}},getApprovedPlayers:()=>e.filter(e=>e.approved&&"player"===e.role),getPlayersByPosition:s=>e.filter(e=>e.approved&&"player"===e.role&&e.position===s)}}(),[i,l]=b.useState(null),[o,n]=b.useState([]),[c,d]=b.useState(!1),[m,x]=b.useState(null),[h,u]=b.useState(e||null),g=e=>e.map(e=>({...e,name:e.email.split("@")[0],team_color:void 0,is_substitute:!1})),p=async e=>{try{d(!0),x(null),u(e);const s=localStorage.getItem(`teamDraw_${e}`);if(s){const e=JSON.parse(s);l(e.teamDraw);const a=t(),r=g(a).map(s=>{const a=e.players.find(e=>e.id===s.id);return a?{...s,...a}:s});n(r)}else{const s={id:`draw_${Date.now()}`,match_id:e,created_at:(new Date).toISOString(),players_per_team:5};l(s);const a=t();n(g(a))}}catch(s){x(s instanceof Error?s.message:"Erro ao carregar sorteio")}finally{d(!1)}},j=e=>o.find(s=>s.id===e),f=()=>{const e={Preto:{total:0,active:0,substitutes:0},Verde:{total:0,active:0,substitutes:0},Cinza:{total:0,active:0,substitutes:0},Vermelho:{total:0,active:0,substitutes:0}};return o.forEach(s=>{s.team_color&&(e[s.team_color].total++,s.is_substitute?e[s.team_color].substitutes++:e[s.team_color].active++)}),e},N=Boolean(i&&o.length>0);return b.useEffect(()=>{e&&e!==h&&p(e)},[e,h]),b.useEffect(()=>{if(s.length>0){const e=g(t());if(h){const s=localStorage.getItem(`teamDraw_${h}`);if(s){const a=JSON.parse(s),r=e.map(e=>{const s=a.players.find(s=>s.id===e.id);return s?{...e,...s}:e});n(r)}else n(e)}else n(e)}},[s,h]),{players:o,teamDraw:i,loading:c||a,error:m||r,getPlayersByTeam:e=>o.filter(s=>s.team_color===e),getAvailablePlayersForTeam:e=>o.filter(s=>!s.team_color||s.team_color===e),getAllAvailablePlayers:()=>o.filter(e=>!e.team_color),loadTeamDraw:p,drawTeams:async(e,s=5)=>{try{d(!0),x(null);const a=t();if(a.length<2*s)throw new Error(`Precisa de pelo menos ${2*s} jogadores para sortear times`);const r=[...a].sort(()=>Math.random()-.5),i=["Preto","Verde","Cinza","Vermelho"].slice(0,Math.ceil(r.length/s)),o=r.map((e,a)=>{const r=Math.floor(a/s),t=i[r],l=a>=s*i.length;return{...e,name:e.email.split("@")[0],team_color:t,is_substitute:l}}),c={id:`draw_${Date.now()}`,match_id:e,created_at:(new Date).toISOString(),players_per_team:s};l(c),n(o),u(e),localStorage.setItem(`teamDraw_${e}`,JSON.stringify({teamDraw:c,players:o}))}catch(a){throw x(a instanceof Error?a.message:"Erro ao sortear times"),a}finally{d(!1)}},refreshTeamDraw:async()=>{h&&await p(h)},substitutePlayer:(e,s,a)=>{n(a=>{const r=[...a],t=r.findIndex(s=>s.id===e),l=r.findIndex(e=>e.id===s);if(-1!==t&&-1!==l){const e=r[t].team_color;r[t].team_color=void 0,r[t].is_substitute=!0,r[l].team_color=e,r[l].is_substitute=!1,h&&localStorage.setItem(`teamDraw_${h}`,JSON.stringify({teamDraw:i,players:r}))}return r})},addPlayerToTeam:(e,s)=>{n(a=>{const r=[...a],t=r.findIndex(s=>s.id===e.id);return-1!==t&&(r[t].team_color=s,r[t].is_substitute=!1,h&&localStorage.setItem(`teamDraw_${h}`,JSON.stringify({teamDraw:i,players:r}))),r})},searchPlayers:e=>{const s=e.toLowerCase();return o.filter(e=>e.email.toLowerCase().includes(s)||e.name?.toLowerCase().includes(s))},getPlayerById:j,getPlayerByName:e=>o.find(s=>s.name===e),canPlayerScore:(e,s)=>{const a=j(e);return Boolean(a&&a.team_color===s&&!a.is_substitute)},canPlayerAssist:(e,s,a)=>{const r=j(e),t=j(s);return Boolean(r&&t&&r.team_color===a&&t.team_color===a&&r.id!==s&&!r.is_substitute)},getTeamStats:f,hasTeamDraw:N,isTeamDrawComplete:(()=>{if(!N)return!1;const e=f();return Object.values(e).filter(e=>e.active>0).length>=2})()}},D={Preto:{bg:"bg-gray-800",text:"text-white",border:"border-gray-800"},Verde:{bg:"bg-green-600",text:"text-white",border:"border-green-600"},Cinza:{bg:"bg-gray-500",text:"text-white",border:"border-gray-500"},Vermelho:{bg:"bg-red-600",text:"text-white",border:"border-red-600"}};function E(){const{matchId:y}=w(),E=v(),{getUpcomingMatches:$}=N(),{players:I,teamDraw:k,loading:J,error:A,getPlayersByTeam:O,getAllAvailablePlayers:z,drawTeams:B,refreshTeamDraw:V,substitutePlayer:M,addPlayerToTeam:q,getTeamStats:L,hasTeamDraw:U,isTeamDrawComplete:F}=T(y),[R,G]=b.useState(!1),[H,K]=b.useState(!1),[Z,Q]=b.useState(null),[W,X]=b.useState(null),[Y,ee]=b.useState(5),se=$(),ae=y?se.find(e=>e.id.toString()===y):null;b.useEffect(()=>{y&&V()},[y]);const re=e=>{switch(e){case"Goleiro":return"bg-yellow-100 text-yellow-800";case"Zagueiro":return"bg-blue-100 text-blue-800";case"Meia":return"bg-green-100 text-green-800";case"Atacante":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},te=s=>{const a=s||0;return e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((s,r)=>e.jsx("div",{className:"h-3 w-3 rounded-full "+(r<a?"bg-yellow-400":"bg-gray-300")},r))})};return J?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando sorteio..."})]})}):y?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{onClick:()=>E("/home"),variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"⚽ Sorteio de Times"}),e.jsx("p",{className:"text-sm text-gray-600",children:ae?`${ae.date} - ${ae.time}`:"Partida não encontrada"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{onClick:V,variant:"outline",size:"sm",disabled:J,children:e.jsx(a,{className:"h-4 w-4 "+(J?"animate-spin":"")})}),e.jsxs(s,{onClick:()=>G(!0),className:"bg-green-600 hover:bg-green-700",disabled:J||I.length<10,children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Sortear"]})]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx(r,{className:"bg-white shadow-sm mb-4",children:e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:I.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Jogadores"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:U?"✅":"❌"}),e.jsx("div",{className:"text-sm text-gray-600",children:U?"Times Sorteados":"Sem Times"})]})]})})}),U?e.jsx("div",{className:"space-y-4",children:Object.entries(L()).map(([a,o])=>{if(0===o.total)return null;const n=O(a),c=D[a];return e.jsxs(r,{className:"bg-white shadow-sm",children:[e.jsx(i,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{className:`text-lg ${c.text} ${c.bg} px-3 py-1 rounded-full`,children:["Time ",a]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o.active," titulares • ",o.substitutes," reservas"]})]})}),e.jsx(t,{className:"space-y-2",children:n.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:r.name||r.email.split("@")[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.position&&e.jsx("span",{className:`text-xs px-2 py-1 rounded ${re(r.position)}`,children:r.position}),te(r.stars)]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.is_substitute&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:"Reserva"}),e.jsx(s,{onClick:()=>{Q(r),X(a),K(!0)},variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(C,{className:"h-3 w-3"})})]})]},r.id))})]},a)})}):e.jsx(r,{className:"bg-white shadow-sm",children:e.jsxs(t,{className:"text-center py-12",children:[e.jsx(_,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum time sorteado"}),e.jsx("p",{className:"text-gray-500 mb-4",children:'Clique em "Sortear" para criar os times automaticamente'}),e.jsxs(s,{onClick:()=>G(!0),className:"bg-green-600 hover:bg-green-700",disabled:I.length<10,children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Sortear Times"]})]})}),U&&e.jsxs(r,{className:"bg-white shadow-sm mt-4",children:[e.jsx(i,{children:e.jsx(l,{className:"text-lg",children:"Jogadores Disponíveis"})}),e.jsx(t,{children:0===z().length?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Todos os jogadores foram distribuídos nos times"}):e.jsx("div",{className:"space-y-2",children:z().map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:a.name||a.email.split("@")[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.position&&e.jsx("span",{className:`text-xs px-2 py-1 rounded ${re(a.position)}`,children:a.position}),te(a.stars)]})]})}),e.jsx("div",{className:"flex gap-1",children:Object.keys(D).map(r=>e.jsx(s,{onClick:()=>((e,s)=>{q(e,s)})(a,r),variant:"outline",size:"sm",className:`h-8 w-8 p-0 ${D[r].border}`,children:e.jsx(P,{className:"h-3 w-3"})},r))})]},a.id))})})]})]}),e.jsx(o,{open:R,onOpenChange:G,children:e.jsxs(n,{className:"sm:max-w-md mx-4",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Sortear Times"]}),e.jsx(m,{children:"Configure os parâmetros para o sorteio dos times."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"players-per-team",children:"Jogadores por time"}),e.jsxs(u,{value:Y.toString(),onValueChange:e=>ee(parseInt(e)),children:[e.jsx(g,{children:e.jsx(p,{})}),e.jsxs(j,{children:[e.jsx(f,{value:"5",children:"5 jogadores por time"}),e.jsx(f,{value:"6",children:"6 jogadores por time"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Jogadores disponíveis:"})," ",I.length]}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Times que serão criados:"})," ",Math.ceil(I.length/Y)]}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Jogadores por time:"})," ",Y]})]})]}),e.jsxs(x,{className:"gap-2",children:[e.jsx(s,{variant:"outline",onClick:()=>G(!1),className:"flex-1",children:"Cancelar"}),e.jsxs(s,{onClick:async()=>{if(y)try{await B(y,Y),G(!1)}catch(e){alert("Erro ao sortear times. Verifique se há jogadores suficientes.")}},className:"flex-1 bg-green-600 hover:bg-green-700",disabled:I.length<2*Y,children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Sortear"]})]})]})}),e.jsx(o,{open:H,onOpenChange:K,children:e.jsxs(n,{className:"sm:max-w-md mx-4",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Substituir Jogador"]}),e.jsxs(m,{children:["Escolha um jogador para substituir ",Z?.name||Z?.email.split("@")[0],"."]})]}),e.jsx("div",{className:"space-y-4",children:W&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Jogadores disponíveis para substituição:"}),z().map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:a.name||a.email.split("@")[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.position&&e.jsx("span",{className:`text-xs px-2 py-1 rounded ${re(a.position)}`,children:a.position}),te(a.stars)]})]})}),e.jsx(s,{onClick:()=>{return e=Z.id,s=a.id,M(e,s,W),K(!1),Q(null),void X(null);var e,s},variant:"outline",size:"sm",children:"Substituir"})]},a.id))]})}),e.jsx(x,{children:e.jsx(s,{variant:"outline",onClick:()=>K(!1),className:"w-full",children:"Cancelar"})})]})}),e.jsx("div",{className:"h-20"})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"ID da partida não encontrado"}),e.jsx(s,{onClick:()=>E("/home"),children:"Voltar ao Início"})]})})}export{E as default};
