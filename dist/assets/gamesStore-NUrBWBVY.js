import{b as t}from"./vendor-react-BSMgdr9Q.js";const e=t=>{let e;const a=new Set,r=(t,r)=>{const n="function"==typeof t?t(e):t;if(!Object.is(n,e)){const t=e;e=(null!=r?r:"object"!=typeof n||null===n)?n:Object.assign({},e,n),a.forEach(a=>a(e,t))}},n=()=>e,s={setState:r,getState:n,getInitialState:()=>o,subscribe:t=>(a.add(t),()=>a.delete(t))},o=e=t(r,n,s);return s},a=t=>t;const r=r=>{const n=(t=>t?e(t):e)(r),s=e=>function(e,r=a){const n=t.useSyncExternalStore(e.subscribe,t.useCallback(()=>r(e.getState()),[e,r]),t.useCallback(()=>r(e.getInitialState()),[e,r]));return t.useDebugValue(n),n}(n,e);return Object.assign(s,n),s},n=t=>t?r(t):r;function s(t,e){let a;try{a=t()}catch(r){return}return{getItem:t=>{var e;const r=t=>null===t?null:JSON.parse(t,void 0),n=null!=(e=a.getItem(t))?e:null;return n instanceof Promise?n.then(r):r(n)},setItem:(t,e)=>a.setItem(t,JSON.stringify(e,void 0)),removeItem:t=>a.removeItem(t)}}const o=t=>e=>{try{const a=t(e);return a instanceof Promise?a:{then:t=>o(t)(a),catch(t){return this}}}catch(a){return{then(t){return this},catch:t=>o(t)(a)}}},c=(t,e)=>(a,r,n)=>{let c={storage:s(()=>localStorage),partialize:t=>t,version:0,merge:(t,e)=>({...e,...t}),...e},i=!1;const l=new Set,u=new Set;let d=c.storage;if(!d)return t((...t)=>{a(...t)},r,n);const h=()=>{const t=c.partialize({...r()});return d.setItem(c.name,{state:t,version:c.version})},m=n.setState;n.setState=(t,e)=>(m(t,e),h());const p=t((...t)=>(a(...t),h()),r,n);let f;n.getInitialState=()=>p;const S=()=>{var t,e;if(!d)return;i=!1,l.forEach(t=>{var e;return t(null!=(e=r())?e:p)});const n=(null==(e=c.onRehydrateStorage)?void 0:e.call(c,null!=(t=r())?t:p))||void 0;return o(d.getItem.bind(d))(c.name).then(t=>{if(t){if("number"!=typeof t.version||t.version===c.version)return[!1,t.state];if(c.migrate){const e=c.migrate(t.state,t.version);return e instanceof Promise?e.then(t=>[!0,t]):[!0,e]}}return[!1,void 0]}).then(t=>{var e;const[n,s]=t;if(f=c.merge(s,null!=(e=r())?e:p),a(f,!0),n)return h()}).then(()=>{null==n||n(f,void 0),f=r(),i=!0,u.forEach(t=>t(f))}).catch(t=>{null==n||n(void 0,t)})};return n.persist={setOptions:t=>{c={...c,...t},t.storage&&(d=t.storage)},clearStorage:()=>{null==d||d.removeItem(c.name)},getOptions:()=>c,rehydrate:()=>S(),hasHydrated:()=>i,onHydrate:t=>(l.add(t),()=>{l.delete(t)}),onFinishHydration:t=>(u.add(t),()=>{u.delete(t)})},c.skipHydration||S(),f||p},i="/api/sync/data";class l{static async saveToServer(t,e){try{const a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matches:t,userId:e})});return(await a.json()).success}catch(a){return!1}}static async loadFromServer(){try{const t=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}}),e=await t.json();return e.success?e.data:null}catch(t){return null}}static async syncWithServer(t,e){try{const a=await this.loadFromServer();if(a&&a.matches&&a.matches.length>0){const r=new Map;a.matches.forEach(t=>{r.set(t.id,t)});const n=[],s=new Set;t.forEach(t=>{const e=r.get(t.id);e?t.createdAt>e.createdAt?n.push(t):n.push(e):n.push(t),s.add(t.id)}),a.matches.forEach(t=>{s.has(t.id)||n.push(t)});return await this.saveToServer(n,e)?n:a.matches}return await this.saveToServer(t,e)?t:null}catch(a){return null}}static async hasNewerData(t){try{const e=await this.loadFromServer();return!(!e||!e.lastUpdated)&&e.lastUpdated>t}catch(e){return!1}}static async clearServerData(){try{const t=await fetch(i,{method:"DELETE",headers:{"Content-Type":"application/json"}});return(await t.json()).success}catch(t){return!1}}}const u=n()(c((t,e)=>({matches:[{id:1,date:"2025-01-25",time:"20:00",location:"R. Renato Bazin, 705-751 - Laranjal, São Gonçalo - RJ, 24725-140",maxPlayers:25,confirmedPlayers:18,status:"open",createdAt:Date.now()-864e5},{id:2,date:"2025-01-27",time:"19:30",location:"R. Renato Bazin, 705-751 - Laranjal, São Gonçalo - RJ, 24725-140",maxPlayers:25,confirmedPlayers:15,status:"open",createdAt:Date.now()-432e5}],addMatch:e=>{const a={...e,id:Date.now(),confirmedPlayers:0,status:"open",createdAt:Date.now()};t(t=>{const e=[...t.matches,a];return l.saveToServer(e).catch(console.error),{matches:e}})},updateMatch:(e,a)=>{t(t=>{const r=t.matches.map(t=>t.id===e?{...t,...a}:t);return l.saveToServer(r).catch(console.error),{matches:r}})},deleteMatch:e=>{t(t=>{const a=t.matches.filter(t=>t.id!==e);return l.saveToServer(a).catch(console.error),{matches:a}})},getUpcomingMatches:()=>{const t=(new Date).toISOString().split("T")[0];return e().matches.filter(e=>{if(!e.date||"string"!=typeof e.date)return!1;let a;if(e.date.includes("/")){const t=e.date.split("/");if(3!==t.length)return!1;const[r,n,s]=t;if(isNaN(Number(r))||isNaN(Number(n))||isNaN(Number(s)))return!1;a=`${s}-${n.padStart(2,"0")}-${r.padStart(2,"0")}`}else{if(!e.date.includes("-"))return!1;{const t=e.date.split("-");if(3!==t.length)return!1;const[r,n,s]=t;if(isNaN(Number(r))||isNaN(Number(n))||isNaN(Number(s)))return!1;a=`${r}-${n.padStart(2,"0")}-${s.padStart(2,"0")}`}}return a>=t&&"cancelled"!==e.status}).sort((t,e)=>{let a,r;if(t.date.includes("/")){const[e,r,n]=t.date.split("/");a=new Date(`${n}-${r.padStart(2,"0")}-${e.padStart(2,"0")}T${t.time}`)}else a=new Date(`${t.date}T${t.time}`);if(e.date.includes("/")){const[t,a,n]=e.date.split("/");r=new Date(`${n}-${a.padStart(2,"0")}-${t.padStart(2,"0")}T${e.time}`)}else r=new Date(`${e.date}T${e.time}`);return a.getTime()-r.getTime()})},getMatchById:t=>e().matches.find(e=>e.id===t)}),{name:"maestrosfc_games",storage:s(()=>localStorage),partialize:t=>({matches:t.matches})}));export{s as a,n as c,c as p,u};
