class e{config;constructor(e){this.config=e}}class t extends e{accessToken;publicKey;baseUrl;constructor(e){super(e),this.accessToken=e.config.access_token,this.publicKey=e.config.public_key,this.baseUrl=e.config.base_url||"https://api.mercadopago.com"}async createPixTransaction(e){try{const t={transaction_amount:e.amount_brl,description:e.description||"Pagamento Maestros FC",payment_method_id:"pix",payer:{email:e.email||"test@example.com",identification:{type:"CPF",number:"12345678901"}},notification_url:`${window.location.origin}/api/pix/webhook/mercadopago`,external_reference:e.external_id},a=await fetch(`${this.baseUrl}/v1/payments`,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json","X-Idempotency-Key":e.external_id},body:JSON.stringify(t)});if(!a.ok){const e=await a.json();throw new Error(`Mercado Pago API Error: ${e.message||"Unknown error"}`)}const r=await a.json(),n=await fetch(`${this.baseUrl}/v1/payments/${r.id}`,{headers:{Authorization:`Bearer ${this.accessToken}`}}),o=await n.json();return{qr_code:o.point_of_interaction?.transaction_data?.qr_code||"",qr_code_image:o.point_of_interaction?.transaction_data?.qr_code_base64,txid:r.id.toString(),end_to_end_id:o.point_of_interaction?.transaction_data?.ticket_url,status:"approved"===r.status?"completed":"pending",provider_response:r}}catch(t){throw t}}async getTransactionStatus(e){try{const t=await fetch(`${this.baseUrl}/v1/payments/${e}`,{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!t.ok)throw new Error("Erro ao buscar status da transação");switch((await t.json()).status){case"approved":return"completed";case"pending":default:return"pending";case"rejected":return"failed";case"cancelled":return"cancelled"}}catch(t){return"failed"}}validateWebhook(e,t){return!0}}class a extends e{email;token;baseUrl;constructor(e){super(e),this.email=e.config.email,this.token=e.config.token,this.baseUrl=e.config.base_url||"https://ws.pagseguro.uol.com.br"}async createPixTransaction(e){try{const t={email:this.email,token:this.token,currency:"BRL",itemId1:e.external_id,itemDescription1:e.description||"Pagamento Maestros FC",itemAmount1:e.amount_brl.toFixed(2),itemQuantity1:1,reference:e.external_id,notificationURL:`${window.location.origin}/api/pix/webhook/pagseguro`,paymentMethod:"pix"},a=new URLSearchParams;Object.entries(t).forEach(([e,t])=>{a.append(e,t.toString())});const r=await fetch(`${this.baseUrl}/v2/transactions`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(!r.ok){const e=await r.text();throw new Error(`PagSeguro API Error: ${e}`)}const n=await r.text(),o=(new DOMParser).parseFromString(n,"text/xml"),i=o.querySelector("code")?.textContent,s=o.querySelector("paymentLink")?.textContent;return{qr_code:s||"",txid:i||e.external_id,status:"pending",provider_response:{xml_response:n}}}catch(t){throw t}}async getTransactionStatus(e){try{const t=await fetch(`${this.baseUrl}/v3/transactions/${e}?email=${this.email}&token=${this.token}`);if(!t.ok)throw new Error("Erro ao buscar status da transação");const a=await t.text(),r=(new DOMParser).parseFromString(a,"text/xml"),n=r.querySelector("status")?.textContent;switch(n){case"3":return"completed";case"1":default:return"pending";case"7":return"cancelled"}}catch(t){return"failed"}}validateWebhook(e,t){return!0}}class r extends e{async createPixTransaction(e){return{qr_code:`pix_offline_${e.external_id}_${Date.now()}`,txid:`offline_${e.external_id}`,status:"pending",provider_response:{provider:"offline",mode:"test",created_at:(new Date).toISOString()}}}async getTransactionStatus(e){const t=["pending","completed","failed"];return t[Math.floor(Math.random()*t.length)]}validateWebhook(e,t){return!0}}function n(e){switch(e.provider){case"mercadopago":return new t(e);case"pagseguro":return new a(e);case"offline":return new r(e);default:throw new Error(`Provedor PIX não suportado: ${e.provider}`)}}export{t as MercadoPagoProvider,r as OfflineProvider,a as PagSeguroProvider,n as createPixProvider};
