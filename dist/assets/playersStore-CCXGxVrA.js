import{c as r,p as e,a}from"./gamesStore-Cx_7RkeL.js";import{supabase as t}from"./supabase-BOE2RgTB.js";import"./vendor-react-Cf1qRDNe.js";import"./vendor-supabase-C2G4akNc.js";import"./vendor-ui-DOZUV3Wy.js";const o=r()(e((r,e)=>({players:[],teamDraw:null,currentMatchId:null,loading:!1,error:null,setCurrentMatch:e=>{r({currentMatchId:e})},loadPlayersFromTeamDraw:async e=>{r({loading:!0,error:null});try{const a=null;if(!a)return void r({teamDraw:null,players:[],loading:!1});const o=Object.values(a.teams).flat(),{data:s,error:l}=await t.from("users").select("*").in("id",o);if(l)throw new Error(`Erro ao carregar usuários: ${l.message}`);const n=[];Object.entries(a.teams).forEach(([r,e])=>{e.forEach(e=>{const a=s?.find(r=>r.id===e.id);a&&n.push({...a,team_color:r,is_substitute:!1})})}),r({teamDraw:a,players:n,currentMatchId:e,loading:!1})}catch(a){r({error:a.message||"Erro ao carregar jogadores",loading:!1})}},drawTeams:async(e,a=5)=>{r({loading:!0,error:null});try{const o=[],s=["offline_players","local_players","players-store","nexus-play-players","app_players"];for(const r of s){const e=localStorage.getItem(r);if(e)try{const r=JSON.parse(e);Array.isArray(r)?o.push(...r):r.players&&Array.isArray(r.players)?o.push(...r.players):r.state&&Array.isArray(r.state.players)&&o.push(...r.state.players)}catch(t){}}if(0===o.length)return void r({players:[],currentMatchId:e,loading:!1,error:"Nenhum jogador cadastrado. Cadastre jogadores no sistema primeiro."});const l=["Gol","Zaga","Meio","Atacante"],n=["Preto","Verde","Cinza","Vermelho"],i=o.filter(r=>r&&r.name).sort(()=>Math.random()-.5),c=[];let u=0;for(let r=0;r<n.length;r++){const e=n[r],t=i.length-u,o=n.length-r;let s;t>=a*o?s=a:(s=Math.floor(t/o),r<t%o&&(s+=1));for(let r=0;r<s&&u<i.length;r++){const r=i[u];c.push({...r,team_color:e,is_substitute:!1,position:r.position||l[Math.floor(Math.random()*l.length)]}),u++}}r({players:c,currentMatchId:e,loading:!1,error:null})}catch(o){r({error:o.message||"Erro ao sortear times",loading:!1})}},getPlayersByTeam:r=>e().players.filter(e=>e.team_color===r),getActivePlayersByTeam:r=>e().players.filter(e=>e.team_color===r&&!e.is_substitute),getAvailablePlayersForTeam:r=>e().players.filter(e=>e.team_color===r),getAllAvailablePlayers:()=>e().players.filter(r=>r.team_color),substitutePlayer:(e,a,t)=>{r(r=>({players:r.players.map(r=>r.id===e?{...r,is_substitute:!0,substituted_at:new Date}:r.id===a?{...r,team_color:t,is_substitute:!1}:r)}))},addSubstitution:(r,a,t)=>{const o=e(),s=o.getPlayerByName(a),l=o.getPlayerByName(t);if(!s)throw new Error(`Jogador "${a}" não encontrado`);if(!l)throw new Error(`Jogador "${t}" não encontrado`);if(s.team_color!==r)throw new Error(`Jogador "${a}" não pertence ao time ${r}`);if(l.team_color!==r)throw new Error(`Jogador "${t}" não pertence ao time ${r}`);if(s.is_substitute)throw new Error(`Jogador "${a}" já está no banco`);if(!l.is_substitute)throw new Error(`Jogador "${t}" já está em campo`);if(a===t)throw new Error("Jogador que sai deve ser diferente do que entra");o.substitutePlayer(s.id,l.id,r)},addPlayerToTeam:(e,a)=>{r(r=>({players:[...r.players,{...e,team_color:a,is_substitute:!1}]}))},removePlayerFromTeam:e=>{r(r=>({players:r.players.filter(r=>r.id!==e)}))},searchPlayers:r=>{const a=r.toLowerCase();return e().players.filter(r=>r.name.toLowerCase().includes(a)||r.position?.toLowerCase().includes(a))},getPlayerById:r=>e().players.find(e=>e.id===r),getPlayerByName:r=>e().players.find(e=>e.name.toLowerCase()===r.toLowerCase()),canPlayerScore:(r,a)=>{const t=e().getPlayerById(r);return t?.team_color===a&&!t?.is_substitute},canPlayerAssist:(r,a,t)=>{const o=e().getPlayerById(r),s=e().getPlayerById(a);return r!==a&&(o?.team_color===t&&s?.team_color===t&&!o?.is_substitute&&!s?.is_substitute)},clearTeamDraw:()=>{r({teamDraw:null,players:[],currentMatchId:null})},reset:()=>{r({players:[],teamDraw:null,currentMatchId:null,loading:!1,error:null})}}),{name:"players-store",storage:a(()=>localStorage),partialize:r=>({players:r.players,teamDraw:r.teamDraw,currentMatchId:r.currentMatchId})}));export{o as usePlayersStore};
