import{j as e}from"./vendor-ui-Cg0qxSES.js";import{r as t}from"./vendor-react-CyD6OLG_.js";import{C as s,f as a,B as i,k as n,a as r,u as c}from"./index-XxW9FBxQ.js";import{I as d}from"./input-uMYoR_2G.js";import{S as l,a as o,b as m,c as p,d as v}from"./select-DPwYioei.js";import{B as u}from"./badge-hWvPWwxj.js";import"./vendor-router-VFXGavtY.js";import"./vendor-pdf-oqmhCI76.js";import"./vendor-utils-CrFdsnXa.js";import"./check-Cf6Eusfg.js";const x=()=>{const[n,r]=t.useState(""),[c,u]=t.useState("mensalista"),[x,h]=t.useState(null),[j,g]=t.useState(!1);return e.jsx(s,{children:e.jsxs(a,{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Criar convite"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-2",children:[e.jsx(d,{value:n,onChange:e=>r(e.target.value),placeholder:"Email do convidado"}),e.jsxs(l,{value:c,onValueChange:e=>u(e),children:[e.jsx(o,{children:e.jsx(m,{placeholder:"Tipo do convite"})}),e.jsxs(p,{children:[e.jsx(v,{value:"mensalista",children:"Mensalista"}),e.jsx(v,{value:"diarista",children:"Diarista"})]})]})]}),e.jsx(i,{onClick:async()=>{if(n){g(!0);try{const e=await fetch("/api/invite/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,membership:c})}),t=await e.json();h(t.url)}finally{g(!1)}}},disabled:j||!n,children:j?"Gerando...":"Gerar convite"}),x&&e.jsxs("div",{className:"grid sm:grid-cols-[1fr_auto_auto] gap-2",children:[e.jsx(d,{readOnly:!0,value:x}),e.jsx(i,{variant:"secondary",onClick:()=>navigator.clipboard.writeText(x),title:"Copiar link",children:"Copiar"}),e.jsx(i,{variant:"outline",onClick:()=>window.open("https://wa.me/?text="),title:"Enviar por WhatsApp",children:"WhatsApp"})]})]})})};function h(){const[l,o]=t.useState(""),{invites:m,pendingInvites:p,acceptedInvites:v,declinedInvites:h,revokeInvite:j,isLoading:g}=function(){const e=n(r.inviteSystem.listInvites),t=n(r.inviteSystem.getInviteStats),s=c(r.inviteSystem.createInvite),a=c(r.inviteSystem.acceptInvite),i=c(r.inviteSystem.revokeInvite),d=e?.filter(e=>"pending"===e.status)||[],l=e?.filter(e=>"accepted"===e.status)||[],o=e?.filter(e=>"declined"===e.status)||[],m=e?.filter(e=>"pending"===e.status&&Date.now()>e.expires_at)||[];return{invites:e||[],pendingInvites:d,acceptedInvites:l,declinedInvites:o,expiredInvites:m,inviteStats:t||{total:0,pending:0,accepted:0,declined:0,expired:0},createInvite:async(e,t)=>{try{return await s({email:e.email,role:e.role,membership:e.membership,createdBy:t,expiresInDays:e.expiresInDays})}catch(a){throw a}},acceptInvite:async(e,t)=>{try{return await a({token:e,userId:t})}catch(s){throw s}},revokeInvite:async e=>{try{await i({inviteId:e})}catch(t){throw t}},isLoading:void 0===e,isStatsLoading:void 0===t}}(),{attendanceRequests:y,pendingRequests:f,approvedRequests:w,rejectedRequests:N,approveAttendanceRequest:I,rejectAttendanceRequest:S,isLoading:q}=function(){const e=n(r.attendance.listAttendanceRequests),t=n(r.attendance.getAttendanceStats),s=c(r.attendance.createAttendanceRequest),a=c(r.attendance.approveAttendanceRequest),i=c(r.attendance.rejectAttendanceRequest),d=e?.filter(e=>"pending"===e.status)||[],l=e?.filter(e=>"approved"===e.status)||[],o=e?.filter(e=>"rejected"===e.status)||[];return{attendanceRequests:e||[],pendingRequests:d,approvedRequests:l,rejectedRequests:o,attendanceStats:t||{total:0,pending:0,approved:0,rejected:0},createAttendanceRequest:async(e,t)=>{try{return await s({userId:e,matchId:t})}catch(a){throw a}},approveAttendanceRequest:async(e,t)=>{try{await a({requestId:e,reviewedBy:t})}catch(s){throw s}},rejectAttendanceRequest:async(e,t)=>{try{await i({requestId:e,reviewedBy:t})}catch(s){throw s}},isLoading:void 0===e,isStatsLoading:void 0===t}}(),R=m.filter(e=>e.email.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{className:"mx-auto w-full max-w-4xl p-4 sm:p-6 space-y-6",children:[e.jsx(x,{}),e.jsx(s,{className:"rounded-2xl",children:e.jsxs(a,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Convites"}),e.jsx(d,{value:l,onChange:e=>o(e.target.value),placeholder:"Buscar por email",className:"max-w-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[g?e.jsx("div",{className:"text-center p-4",children:"Carregando convites..."}):R.map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-xl border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:t.email}),e.jsxs("div",{className:"text-xs text-zinc-500",children:[new Date(t.created_at).toLocaleString()," • ",t.membership]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"secondary",children:t.status}),"sent"===t.status&&e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{try{await j(e)}catch(t){}})(t.id),children:"Revogar"})]})]},t.id)),!g&&0===R.length&&e.jsx("div",{className:"text-sm text-zinc-500",children:"Sem convites."})]})]})}),e.jsx(s,{className:"rounded-2xl",children:e.jsxs(a,{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Aprovação de Diaristas"}),e.jsxs("div",{className:"space-y-2",children:[q?e.jsx("div",{className:"text-center p-4",children:"Carregando solicitações..."}):y.map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-xl border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Req #",t.id.slice(0,8)]}),e.jsxs("div",{className:"text-xs text-zinc-500",children:[new Date(t.requested_at).toLocaleString()," • status: ",t.status]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{try{await I(e,"admin")}catch(t){}})(t.id),disabled:"pending"!==t.status,children:"Aprovar"}),e.jsx(i,{size:"sm",variant:"secondary",onClick:()=>(async e=>{try{await S(e,"admin")}catch(t){}})(t.id),disabled:"pending"!==t.status,children:"Rejeitar"})]})]},t.id)),!q&&0===y.length&&e.jsx("div",{className:"text-sm text-zinc-500",children:"Sem solicitações."})]})]})})]})}export{h as default};
