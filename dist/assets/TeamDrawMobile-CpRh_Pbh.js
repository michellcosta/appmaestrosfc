const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/db-rZLe2VBZ.js","assets/supabase-DgB9yu4v.js","assets/vendor-supabase-5K_8OYiR.js","assets/vendor-react-BSMgdr9Q.js","assets/vendor-ui-Bl6_fDik.js"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-Bl6_fDik.js";import{B as s,R as a,C as t,a as r,d as i,e as l}from"./index-D-h0AB1a.js";import{D as o,a as n,b as c,c as d,d as m,e as x}from"./dialog-CX7tWYuj.js";import{L as h}from"./label-BetwYsf8.js";import{S as u,a as g,b as p,c as j,d as f}from"./select-ObUtRLUd.js";import{_ as b}from"./vendor-supabase-5K_8OYiR.js";import{r as y}from"./vendor-react-BSMgdr9Q.js";import{supabase as w}from"./supabase-DgB9yu4v.js";import{u as N}from"./gamesStore-NUrBWBVY.js";import{d as v,u as _}from"./vendor-router-uw2sfKrb.js";import{A as S}from"./arrow-left-DryN1BiL.js";import{S as T}from"./shuffle-CjUawswV.js";import{U as C}from"./user-minus-DV9VsbGJ.js";import{U as P}from"./user-plus-ODQ3hupG.js";import"./vendor-utils-CrFdsnXa.js";const D=e=>{const{players:s,loading:a,error:t,getApprovedPlayers:r}=function(){const[e,s]=y.useState([]),[a,t]=y.useState(!1),[r,i]=y.useState(null),l=async()=>{try{t(!0),i(null);const{data:e,error:a}=await w.from("profiles").select("*").order("updated_at",{ascending:!1});if(a)throw a;s(e||[])}catch(e){i(e instanceof Error?e.message:"Erro desconhecido")}finally{t(!1)}};return y.useEffect(()=>{l()},[]),{players:e,loading:a,error:r,loadPlayers:l,createPlayer:async e=>{try{i(null);const{data:s,error:a}=await w.auth.admin.createUser({email:e.email,password:"temp123456",email_confirm:!0});if(a)throw a;const{error:t}=await w.from("profiles").insert({id:s.user.id,...e});if(t)throw t;await l()}catch(s){throw i(s instanceof Error?s.message:"Erro ao criar jogador"),s}},updatePlayer:async(e,s)=>{try{i(null);const{error:a}=await w.from("profiles").update(s).eq("id",e);if(a)throw a;await l()}catch(a){throw i(a instanceof Error?a.message:"Erro ao atualizar jogador"),a}},deletePlayer:async e=>{try{i(null);const{error:s}=await w.auth.admin.deleteUser(e),{error:a}=await w.from("profiles").delete().eq("id",e);if(a)throw a;await l()}catch(s){throw i(s instanceof Error?s.message:"Erro ao excluir jogador"),s}},toggleApproval:async s=>{try{i(null);const a=e.find(e=>e.id===s);if(!a)throw new Error("Jogador não encontrado");const{error:t}=await w.from("profiles").update({approved:!a.approved}).eq("id",s);if(t)throw t;await l()}catch(a){throw i(a instanceof Error?a.message:"Erro ao alterar aprovação"),a}},getApprovedPlayers:()=>e.filter(e=>e.approved&&"player"===e.role),getPlayersByPosition:s=>e.filter(e=>e.approved&&"player"===e.role&&e.position===s)}}(),[i,l]=y.useState(null),[o,n]=y.useState([]),[c,d]=y.useState(!1),[m,x]=y.useState(null),[h,u]=y.useState(e||null),g=e=>e.map(e=>({...e,name:e.email.split("@")[0],team_color:void 0,is_substitute:!1})),p=async e=>{try{d(!0),x(null),u(e);const s=localStorage.getItem(`teamDraw_${e}`);if(s){const e=JSON.parse(s);l(e.teamDraw);const a=r(),t=g(a).map(s=>{const a=e.players.find(e=>e.id===s.id);return a?{...s,...a}:s});n(t)}else{const s={id:`draw_${Date.now()}`,match_id:e,created_at:(new Date).toISOString(),players_per_team:5};l(s);const a=r();n(g(a))}}catch(s){x(s instanceof Error?s.message:"Erro ao carregar sorteio")}finally{d(!1)}},j=e=>o.find(s=>s.id===e),f=()=>{const e={Preto:{total:0,active:0,substitutes:0},Verde:{total:0,active:0,substitutes:0},Cinza:{total:0,active:0,substitutes:0},Vermelho:{total:0,active:0,substitutes:0}};return o.forEach(s=>{s.team_color&&(e[s.team_color].total++,s.is_substitute?e[s.team_color].substitutes++:e[s.team_color].active++)}),e},N=Boolean(i&&o.length>0);return y.useEffect(()=>{e&&e!==h&&p(e)},[e,h]),y.useEffect(()=>{if(s.length>0){const e=g(r());if(h){const s=localStorage.getItem(`teamDraw_${h}`);if(s){const a=JSON.parse(s),t=e.map(e=>{const s=a.players.find(s=>s.id===e.id);return s?{...e,...s}:e});n(t)}else n(e)}else n(e)}},[s,h]),{players:o,teamDraw:i,loading:c||a,error:m||t,getPlayersByTeam:e=>o.filter(s=>s.team_color===e),getAvailablePlayersForTeam:e=>o.filter(s=>!s.team_color||s.team_color===e),getAllAvailablePlayers:()=>o.filter(e=>!e.team_color),loadTeamDraw:p,drawTeams:async(e,s=5)=>{try{d(!0),x(null);const t=r();if(t.length<2*s)throw new Error(`Precisa de pelo menos ${2*s} jogadores para sortear times`);const i=[...t].sort(()=>Math.random()-.5),o=["Preto","Verde","Cinza","Vermelho"].slice(0,Math.ceil(i.length/s)),c=i.map((e,a)=>{const t=Math.floor(a/s),r=o[t],i=a>=s*o.length;return{...e,name:e.email.split("@")[0],team_color:r,is_substitute:i}}),m={id:`draw_${Date.now()}`,match_id:e,created_at:(new Date).toISOString(),players_per_team:s};l(m),n(c),u(e),localStorage.setItem(`teamDraw_${e}`,JSON.stringify({teamDraw:m,players:c}));try{const{createMatchWithTeams:e}=await b(async()=>{const{createMatchWithTeams:e}=await import("./db-rZLe2VBZ.js");return{createMatchWithTeams:e}},__vite__mapDeps([0,1,2,3,4])),a=o.length;await e({teamCount:a,players:i.map(e=>({id:e.id,name:e.email.split("@")[0]||e.email})),playersPerTeam:s})}catch(a){}}catch(t){throw x(t instanceof Error?t.message:"Erro ao sortear times"),t}finally{d(!1)}},refreshTeamDraw:async()=>{h&&await p(h)},substitutePlayer:(e,s,a)=>{n(a=>{const t=[...a],r=t.findIndex(s=>s.id===e),l=t.findIndex(e=>e.id===s);if(-1!==r&&-1!==l){const e=t[r].team_color;t[r].team_color=void 0,t[r].is_substitute=!0,t[l].team_color=e,t[l].is_substitute=!1,h&&localStorage.setItem(`teamDraw_${h}`,JSON.stringify({teamDraw:i,players:t}))}return t})},addPlayerToTeam:(e,s)=>{n(a=>{const t=[...a],r=t.findIndex(s=>s.id===e.id);return-1!==r&&(t[r].team_color=s,t[r].is_substitute=!1,h&&localStorage.setItem(`teamDraw_${h}`,JSON.stringify({teamDraw:i,players:t}))),t})},searchPlayers:e=>{const s=e.toLowerCase();return o.filter(e=>e.email.toLowerCase().includes(s)||e.name?.toLowerCase().includes(s))},getPlayerById:j,getPlayerByName:e=>o.find(s=>s.name===e),canPlayerScore:(e,s)=>{const a=j(e);return Boolean(a&&a.team_color===s&&!a.is_substitute)},canPlayerAssist:(e,s,a)=>{const t=j(e),r=j(s);return Boolean(t&&r&&t.team_color===a&&r.team_color===a&&t.id!==s&&!t.is_substitute)},getTeamStats:f,hasTeamDraw:N,isTeamDrawComplete:(()=>{if(!N)return!1;const e=f();return Object.values(e).filter(e=>e.active>0).length>=2})()}},E={Preto:{bg:"bg-gray-800",text:"text-white",border:"border-gray-800"},Verde:{bg:"bg-green-600",text:"text-white",border:"border-green-600"},Cinza:{bg:"bg-gray-500",text:"text-white",border:"border-gray-500"},Vermelho:{bg:"bg-red-600",text:"text-white",border:"border-red-600"}};function I(){const{matchId:b}=v(),w=_(),{getUpcomingMatches:I}=N(),{players:$,teamDraw:k,loading:A,error:J,getPlayersByTeam:O,getAllAvailablePlayers:z,drawTeams:B,refreshTeamDraw:M,substitutePlayer:V,addPlayerToTeam:q,getTeamStats:L,hasTeamDraw:U,isTeamDrawComplete:R}=D(b),[W,F]=y.useState(!1),[G,H]=y.useState(!1),[K,Z]=y.useState(null),[Q,X]=y.useState(null),[Y,ee]=y.useState(5),se=I(),ae=b?se.find(e=>e.id.toString()===b):null;y.useEffect(()=>{b&&M()},[b]);const te=e=>{switch(e){case"Goleiro":return"bg-yellow-100 text-yellow-800";case"Zagueiro":return"bg-blue-100 text-blue-800";case"Meia":return"bg-green-100 text-green-800";case"Atacante":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},re=s=>{const a=s||0;return e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((s,t)=>e.jsx("div",{className:"h-3 w-3 rounded-full "+(t<a?"bg-yellow-400":"bg-gray-300")},t))})};return A?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando sorteio..."})]})}):b?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{onClick:()=>w("/home"),variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"⚽ Sorteio de Times"}),e.jsx("p",{className:"text-sm text-gray-600",children:ae?`${ae.date} - ${ae.time}`:"Partida não encontrada"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{onClick:M,variant:"outline",size:"sm",disabled:A,children:e.jsx(a,{className:"h-4 w-4 "+(A?"animate-spin":"")})}),e.jsxs(s,{onClick:()=>F(!0),className:"bg-green-600 hover:bg-green-700",disabled:A||$.length<10,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Sortear"]})]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx(t,{className:"bg-white shadow-sm mb-4",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:$.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Jogadores"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:U?"✅":"❌"}),e.jsx("div",{className:"text-sm text-gray-600",children:U?"Times Sorteados":"Sem Times"})]})]})})}),U?e.jsx("div",{className:"space-y-4",children:Object.entries(L()).map(([a,o])=>{if(0===o.total)return null;const n=O(a),c=E[a];return e.jsxs(t,{className:"bg-white shadow-sm",children:[e.jsx(i,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{className:`text-lg ${c.text} ${c.bg} px-3 py-1 rounded-full`,children:["Time ",a]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o.active," titulares • ",o.substitutes," reservas"]})]})}),e.jsx(r,{className:"space-y-2",children:n.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:t.name||t.email.split("@")[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.position&&e.jsx("span",{className:`text-xs px-2 py-1 rounded ${te(t.position)}`,children:t.position}),re(t.stars)]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_substitute&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:"Reserva"}),e.jsx(s,{onClick:()=>{Z(t),X(a),H(!0)},variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(C,{className:"h-3 w-3"})})]})]},t.id))})]},a)})}):e.jsx(t,{className:"bg-white shadow-sm",children:e.jsxs(r,{className:"text-center py-12",children:[e.jsx(T,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum time sorteado"}),e.jsx("p",{className:"text-gray-500 mb-4",children:'Clique em "Sortear" para criar os times automaticamente'}),e.jsxs(s,{onClick:()=>F(!0),className:"bg-green-600 hover:bg-green-700",disabled:$.length<10,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Sortear Times"]})]})}),U&&e.jsxs(t,{className:"bg-white shadow-sm mt-4",children:[e.jsx(i,{children:e.jsx(l,{className:"text-lg",children:"Jogadores Disponíveis"})}),e.jsx(r,{children:0===z().length?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Todos os jogadores foram distribuídos nos times"}):e.jsx("div",{className:"space-y-2",children:z().map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:a.name||a.email.split("@")[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.position&&e.jsx("span",{className:`text-xs px-2 py-1 rounded ${te(a.position)}`,children:a.position}),re(a.stars)]})]})}),e.jsx("div",{className:"flex gap-1",children:Object.keys(E).map(t=>e.jsx(s,{onClick:()=>((e,s)=>{q(e,s)})(a,t),variant:"outline",size:"sm",className:`h-8 w-8 p-0 ${E[t].border}`,children:e.jsx(P,{className:"h-3 w-3"})},t))})]},a.id))})})]})]}),e.jsx(o,{open:W,onOpenChange:F,children:e.jsxs(n,{className:"sm:max-w-md mx-4",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Sortear Times"]}),e.jsx(m,{children:"Configure os parâmetros para o sorteio dos times."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"players-per-team",children:"Jogadores por time"}),e.jsxs(u,{value:Y.toString(),onValueChange:e=>ee(parseInt(e)),children:[e.jsx(g,{children:e.jsx(p,{})}),e.jsxs(j,{children:[e.jsx(f,{value:"5",children:"5 jogadores por time"}),e.jsx(f,{value:"6",children:"6 jogadores por time"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Jogadores disponíveis:"})," ",$.length]}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Times que serão criados:"})," ",Math.ceil($.length/Y)]}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Jogadores por time:"})," ",Y]})]})]}),e.jsxs(x,{className:"gap-2",children:[e.jsx(s,{variant:"outline",onClick:()=>F(!1),className:"flex-1",children:"Cancelar"}),e.jsxs(s,{onClick:async()=>{if(b)try{await B(b,Y),F(!1)}catch(e){alert("Erro ao sortear times. Verifique se há jogadores suficientes.")}},className:"flex-1 bg-green-600 hover:bg-green-700",disabled:$.length<2*Y,children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Sortear"]})]})]})}),e.jsx(o,{open:G,onOpenChange:H,children:e.jsxs(n,{className:"sm:max-w-md mx-4",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Substituir Jogador"]}),e.jsxs(m,{children:["Escolha um jogador para substituir ",K?.name||K?.email.split("@")[0],"."]})]}),e.jsx("div",{className:"space-y-4",children:Q&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Jogadores disponíveis para substituição:"}),z().map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:a.name||a.email.split("@")[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.position&&e.jsx("span",{className:`text-xs px-2 py-1 rounded ${te(a.position)}`,children:a.position}),re(a.stars)]})]})}),e.jsx(s,{onClick:()=>{return e=K.id,s=a.id,V(e,s,Q),H(!1),Z(null),void X(null);var e,s},variant:"outline",size:"sm",children:"Substituir"})]},a.id))]})}),e.jsx(x,{children:e.jsx(s,{variant:"outline",onClick:()=>H(!1),className:"w-full",children:"Cancelar"})})]})}),e.jsx("div",{className:"h-20"})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"ID da partida não encontrado"}),e.jsx(s,{onClick:()=>w("/home"),children:"Voltar ao Início"})]})})}export{I as default};
