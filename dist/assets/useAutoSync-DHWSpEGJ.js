import{u as t}from"./matchStore-Cq_uepae.js";import{c as s,p as a,a as e}from"./middleware-BLDYzNRS.js";import{r as n}from"./vendor-react-CyD6OLG_.js";import{u as o,a as r}from"./index-XxW9FBxQ.js";const i=s()(a((t,s)=>({stats:[],lastResetDate:null,addGoal:s=>{t(t=>t.stats.find(t=>t.name===s)?{stats:t.stats.map(t=>t.name===s?{...t,goals:t.goals+1,lastUpdated:Date.now()}:t)}:{stats:[...t.stats,{name:s,goals:1,assists:0,lastUpdated:Date.now()}]})},addAssist:s=>{t(t=>t.stats.find(t=>t.name===s)?{stats:t.stats.map(t=>t.name===s?{...t,assists:t.assists+1,lastUpdated:Date.now()}:t)}:{stats:[...t.stats,{name:s,goals:0,assists:1,lastUpdated:Date.now()}]})},removeGoal:s=>{t(t=>{const a=t.stats.find(t=>t.name===s);return a&&a.goals>0?{stats:t.stats.map(t=>t.name===s?{...t,goals:Math.max(0,t.goals-1),lastUpdated:Date.now()}:t)}:t})},removeAssist:s=>{t(t=>{const a=t.stats.find(t=>t.name===s);return a&&a.assists>0?{stats:t.stats.map(t=>t.name===s?{...t,assists:Math.max(0,t.assists-1),lastUpdated:Date.now()}:t)}:t})},resetStats:s=>{t({stats:[],lastResetDate:s})},clearStats:()=>{t({stats:[],lastResetDate:null})},getStats:()=>{const{stats:t}=s();return t.filter(t=>t.goals>0||t.assists>0).sort((t,s)=>s.goals-t.goals||s.assists-t.assists||t.name.localeCompare(s.name))},shouldResetStats:t=>{const{lastResetDate:a}=s();return!!a&&t!==a}}),{name:"maestrosfc_player_stats",storage:e(()=>localStorage),partialize:t=>({stats:t.stats,lastResetDate:t.lastResetDate})}));function l(){const[s,a]=n.useState(navigator.onLine),[e,l]=n.useState(Date.now()),[m,d]=n.useState(!1),{stats:c,resetStats:f}=i(),{events:u,clearEvents:w}=t();o(r.playerStats.update),n.useEffect(()=>{const t=()=>{a(!0),l(Date.now()),p()},s=()=>{a(!1)};return window.addEventListener("online",t),window.addEventListener("offline",s),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}},[]);const p=async()=>{if(!m)try{d(!0);const s=c,a=u;for(const e of s)try{await new Promise(t=>setTimeout(t,100))}catch(t){}for(const e of a)try{await new Promise(t=>setTimeout(t,50))}catch(t){}l(Date.now())}catch(t){}finally{d(!1)}};return{isOnline:s,lastSync:e,isSyncing:m,offlineStatsCount:c.length,matchEventsCount:u.length,forceSync:()=>{s&&p()}}}export{l as a,i as u};
