import{j as e}from"./vendor-ui-Cg0qxSES.js";import{c as a,h as s,C as r,d as o,e as l,o as n,f as t,j as i,L as c,B as d}from"./index-XxW9FBxQ.js";import{r as m}from"./vendor-react-CyD6OLG_.js";import{D as g}from"./database-Ce_Wfjf8.js";import"./vendor-router-VFXGavtY.js";import"./vendor-pdf-oqmhCI76.js";import"./vendor-utils-CrFdsnXa.js";const x=a("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function p(){const{createPlayer:a,players:p}=s(),[h,j]=m.useState("idle"),[u,v]=m.useState(""),[f,b]=m.useState([]),[y,N]=m.useState(0),w=()=>{try{const a=["players","player_data","offline_players","managed_players"];let s=[];for(const o of a){const a=localStorage.getItem(o);if(a)try{const e=JSON.parse(a);Array.isArray(e)&&e.length>0&&(s=[...s,...e])}catch(e){}}const r=Array.from(new Map(s.map(e=>[e.email||e.name,e])).values());return b(r),v(`✅ Encontrados ${r.length} jogadores no localStorage`),r}catch(a){return v(`❌ Erro: ${a}`),[]}};return m.useState(()=>{w()}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:e.jsxs(r,{children:[e.jsxs(o,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-6 h-6"}),"Migrar Jogadores para Convex"]}),e.jsx(n,{children:"Transferir jogadores do localStorage para o banco de dados Convex"})]}),e.jsxs(t,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(g,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Jogadores no localStorage: ",e.jsx("strong",{children:f.length})]}),e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Jogadores no Convex: ",e.jsx("strong",{children:p?.length||0})]})]})]}),f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-700",children:"Jogadores encontrados:"}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-1 border rounded-lg p-3 bg-white",children:f.map((a,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(i,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:a.name}),a.email&&e.jsxs("span",{className:"text-gray-500 text-xs",children:["(",a.email,")"]})]},s))})]}),u&&e.jsx("div",{className:"p-4 rounded-lg border "+("success"===h?"bg-green-50 border-green-200":"error"===h?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"),children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap",children:u})}),"migrating"===h&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(c,{className:"w-5 h-5 text-yellow-600 animate-spin"}),e.jsxs("p",{className:"text-sm font-medium text-yellow-900",children:["Migrando... ",y,"/",f.length]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{onClick:w,variant:"outline",disabled:"migrating"===h,className:"flex-1",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Recarregar Jogadores"]}),e.jsx(d,{onClick:async()=>{j("migrating"),N(0),v("🔄 Iniciando migração...");const e=f.length>0?f:w();if(0===e.length)return j("error"),void v("❌ Nenhum jogador encontrado no localStorage");let s=0,r=0;const o=[];for(const n of e)try{const r=p?.some(e=>e.email===n.email||e.name===n.name&&!n.email);if(r){s++,N(s);continue}await a({name:n.name||"Sem nome",email:n.email||`${n.name?.toLowerCase().replace(/\s+/g,".")}@maestros.com`,phone:n.phone||n.telefone||"",role:n.role||"player",position:n.position||n.posicao||"",active:void 0===n.active||n.active,approved:void 0===n.approved||n.approved,avatar_url:n.avatar_url||n.avatar||""}),s++,N(s),v(`🔄 Migrando... ${s}/${e.length}`),await new Promise(e=>setTimeout(e,300))}catch(l){r++;const e=`${n.name}: ${l.message}`;o.push(e)}0===r?(j("success"),v(`✅ Migração completa! ${s} jogadores migrados com sucesso.`)):(j("error"),v(`⚠️ Migração concluída com erros:\n${s} sucesso, ${r} erros\n\nErros:\n${o.join("\n")}`))},disabled:"migrating"===h||0===f.length,className:"flex-1",children:"migrating"===h?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}),"Migrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Migrar para Convex"]})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold mb-2",children:"📋 Instruções:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Clique em "Recarregar Jogadores" para buscar no localStorage'}),e.jsx("li",{children:"Revise a lista de jogadores encontrados"}),e.jsx("li",{children:'Clique em "Migrar para Convex" para transferir'}),e.jsx("li",{children:"Após a migração, os jogadores estarão salvos na nuvem ☁️"})]})]}),"success"===h&&e.jsxs(d,{onClick:()=>window.location.href="/manage-players",className:"w-full",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Ir para Gerenciar Jogadores"]})]})]})})})}export{p as default};
