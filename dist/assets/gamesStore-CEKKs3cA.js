import{c as t,p as e,a}from"./middleware-BLDYzNRS.js";const r="/api/sync/data";class s{static async saveToServer(t,e){try{const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matches:t,userId:e})});return(await a.json()).success}catch(a){return!1}}static async loadFromServer(){try{const t=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}),e=await t.json();return e.success?e.data:null}catch(t){return null}}static async syncWithServer(t,e){try{const a=await this.loadFromServer();if(a&&a.matches&&a.matches.length>0){const r=new Map;a.matches.forEach(t=>{r.set(t.id,t)});const s=[],n=new Set;t.forEach(t=>{const e=r.get(t.id);e?t.createdAt>e.createdAt?s.push(t):s.push(e):s.push(t),n.add(t.id)}),a.matches.forEach(t=>{n.has(t.id)||s.push(t)});return await this.saveToServer(s,e)?s:a.matches}return await this.saveToServer(t,e)?t:null}catch(a){return null}}static async hasNewerData(t){try{const e=await this.loadFromServer();return!(!e||!e.lastUpdated)&&e.lastUpdated>t}catch(e){return!1}}static async clearServerData(){try{const t=await fetch(r,{method:"DELETE",headers:{"Content-Type":"application/json"}});return(await t.json()).success}catch(t){return!1}}}const n=t()(e((t,e)=>({matches:[{id:1,date:"2025-01-25",time:"20:00",location:"R. Renato Bazin, 705-751 - Laranjal, São Gonçalo - RJ, 24725-140",maxPlayers:25,confirmedPlayers:18,status:"open",createdAt:Date.now()-864e5},{id:2,date:"2025-01-27",time:"19:30",location:"R. Renato Bazin, 705-751 - Laranjal, São Gonçalo - RJ, 24725-140",maxPlayers:25,confirmedPlayers:15,status:"open",createdAt:Date.now()-432e5}],addMatch:e=>{const a={...e,id:Date.now(),confirmedPlayers:0,status:"open",createdAt:Date.now()};t(t=>{const e=[...t.matches,a];return s.saveToServer(e).catch(console.error),{matches:e}})},updateMatch:(e,a)=>{t(t=>{const r=t.matches.map(t=>t.id===e?{...t,...a}:t);return s.saveToServer(r).catch(console.error),{matches:r}})},deleteMatch:e=>{t(t=>{const a=t.matches.filter(t=>t.id!==e);return s.saveToServer(a).catch(console.error),{matches:a}})},getUpcomingMatches:()=>{const t=(new Date).toISOString().split("T")[0];return e().matches.filter(e=>{if(!e.date||"string"!=typeof e.date)return!1;let a;if(e.date.includes("/")){const t=e.date.split("/");if(3!==t.length)return!1;const[r,s,n]=t;if(isNaN(Number(r))||isNaN(Number(s))||isNaN(Number(n)))return!1;a=`${n}-${s.padStart(2,"0")}-${r.padStart(2,"0")}`}else{if(!e.date.includes("-"))return!1;{const t=e.date.split("-");if(3!==t.length)return!1;const[r,s,n]=t;if(isNaN(Number(r))||isNaN(Number(s))||isNaN(Number(n)))return!1;a=`${r}-${s.padStart(2,"0")}-${n.padStart(2,"0")}`}}return a>=t&&"cancelled"!==e.status}).sort((t,e)=>{let a,r;if(t.date.includes("/")){const[e,r,s]=t.date.split("/");a=new Date(`${s}-${r.padStart(2,"0")}-${e.padStart(2,"0")}T${t.time}`)}else a=new Date(`${t.date}T${t.time}`);if(e.date.includes("/")){const[t,a,s]=e.date.split("/");r=new Date(`${s}-${a.padStart(2,"0")}-${t.padStart(2,"0")}T${e.time}`)}else r=new Date(`${e.date}T${e.time}`);return a.getTime()-r.getTime()})},getMatchById:t=>e().matches.find(e=>e.id===t)}),{name:"maestrosfc_games",storage:a(()=>localStorage),partialize:t=>({matches:t.matches})}));export{n as u};
