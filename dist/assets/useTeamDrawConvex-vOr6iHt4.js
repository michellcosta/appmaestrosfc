import{r as e}from"./vendor-react-CyD6OLG_.js";import{h as t}from"./index-XxW9FBxQ.js";class r{seed;constructor(e){this.seed=e}next(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280}}function a(e,t,r){const a=Object.entries(e).filter(([e,t])=>t&&t.players.length<r);if(0===a.length)return null;a.sort(([,e],[,t])=>e.totalStars!==t.totalStars?e.totalStars-t.totalStars:e.players.length-t.players.length);const s=a[0][1].totalStars,n=a.filter(([,e])=>e.totalStars===s);return n[Math.floor(Math.random()*n.length)][0]}function s(e,t,r){const a=e[t];a&&(a.players.push(r),a.totalStars+=r.stars||0)}function n(e,t,r){const n=r||Math.ceil(e.length/t),o={Preto:{players:[],totalStars:0},Verde:{players:[],totalStars:0},Cinza:{players:[],totalStars:0}};4===t&&(o.Vermelho={players:[],totalStars:0});const l=function(e,t,r){const n=["Goleiro","goleiro","Gol"],o=[],l=[];return e.forEach(e=>{e.position&&n.includes(e.position)?o.push(e):l.push(e)}),o.forEach(e=>{const n=a(t,0,r);n&&s(t,n,e)}),l}(e,o,n);[...l].sort((e,t)=>{const r=e.stars||0;return(t.stars||0)-r}).forEach(e=>{const t=a(o,0,n);t&&s(o,t,e)});const c=function(e){const t=Object.values(e).filter(Boolean),r=t.map(e=>e.totalStars),a=r.reduce((e,t)=>e+t,0)/t.length,s=Math.min(...r),n=Math.max(...r),o=r.reduce((e,t)=>e+Math.pow(t-a,2),0)/t.length;return{averageStars:a,minStars:s,maxStars:n,variance:o}}(o);return{teams:o,stats:c}}function o(e,t){return["Preto","Verde","Cinza","Vermelho"].every(r=>{const a=e[r],s=t[r];if(!a&&!s)return!0;if(!a||!s)return!1;if(a.players.length!==s.players.length)return!1;const n=a.players.map(e=>e._id).sort(),o=s.players.map(e=>e._id).sort();return n.every((e,t)=>e===o[t])})}function l(e){const t=function(e){const t=e.filter(e=>e.stars&&e.stars>0);if(0===t.length)return 10;const r=t.reduce((e,t)=>e+(t.stars||0),0)/t.length;return Math.round(r)}(e);return e.map(e=>({...e,stars:e.stars&&e.stars>0?e.stars:t}))}function c(e,t,a,s){const o=l(e),{shuffled:c,seed:i}=function(e,t){const a=t??Date.now()+1e3*Math.random(),s=new r(a),n=[...e];for(let r=n.length-1;r>0;r--){const e=Math.floor(s.next()*(r+1));[n[r],n[e]]=[n[e],n[r]]}return{shuffled:n,seed:a}}(o,a),u=e.length>=24?4:3,d=s||Math.ceil(e.length/u),{teams:h,stats:m}=n(c,u,d);return{matchId:t,teams:h,selectedPlayerIds:e.map(e=>e._id),createdAt:Date.now(),seed:i,stats:m}}function i(e){return e.length<6?{valid:!1,message:"Selecione pelo menos 6 jogadores para o sorteio",minRequired:6}:{valid:!0,minRequired:6}}function u(r){const{players:a,isLoading:s}=t(),[n,l]=e.useState(null),[u,d]=e.useState(new Set),h=e.useMemo(()=>a.filter(e=>e.approved&&e.active),[a]),m=e.useMemo(()=>h.filter(e=>u.has(e._id)),[h,u]),f=e.useCallback(e=>{d(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),g=e.useCallback(()=>{const e=new Set(h.map(e=>e._id));d(e)},[h]),p=e.useCallback(()=>{d(new Set)},[]),S=e.useCallback(async(e,t,r)=>{if(!e)throw new Error("Match ID é obrigatório");const a=i(m);if(!a.valid)throw new Error(a.message);const s=c(m,e,r,t);return l(s),localStorage.setItem(`teamDraw_${e}`,JSON.stringify(s)),s},[m]),y=e.useCallback(async(e,t)=>{if(!e)throw new Error("Match ID é obrigatório");const r=i(m);if(!r.valid)throw new Error(r.message);const a=function(e,t,r,a=10,s){if(!r)return c(e,t,void 0,s);for(let n=0;n<a;n++){const a=c(e,t,Date.now()+1e3*n+1e3*Math.random(),s);if(!o(a.teams,r.teams))return a}return c(e,t,Date.now()+1e4*Math.random(),s)}(m,e,n||void 0,10,t);return l(a),localStorage.setItem(`teamDraw_${e}`,JSON.stringify(a)),a},[m,n]),w=e.useCallback(async e=>{const t=localStorage.getItem(`teamDraw_${e}`);if(t)try{const e=JSON.parse(t);return l(e),d(new Set(e.selectedPlayerIds)),e}catch(r){return null}return null},[]),M=e.useCallback(e=>n&&n.teams[e]?.players||[],[n]),v=e.useCallback(e=>!!localStorage.getItem(`teamDraw_${e}`),[]),D=e.useCallback(e=>{const t=localStorage.getItem(`teamDraw_${e}`);if(t)try{return!!JSON.parse(t).teams}catch{return!1}return!1},[]),b=e.useMemo(()=>i(m),[m]);return{approvedPlayers:h,selectedPlayers:m,selectedPlayerIds:u,currentDraw:n,isLoading:s,validation:b,togglePlayerSelection:f,selectAll:g,clearSelection:p,drawTeams:S,redraw:y,loadTeamDraw:w,getPlayersByTeam:M,hasTeamDraw:v,isTeamDrawComplete:D}}export{u};
