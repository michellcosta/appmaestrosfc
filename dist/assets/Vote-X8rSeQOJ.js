import{j as e}from"./vendor-ui-Bl6_fDik.js";import{r as s}from"./vendor-react-BSMgdr9Q.js";import{supabase as a}from"./supabase-DgB9yu4v.js";import{u as r,C as t,a as l,B as o,U as i,Z as n,S as c}from"./index-D-h0AB1a.js";import{S as d,a as m,b as x,c as p,d as u}from"./select-ObUtRLUd.js";import{u as j}from"./usePermissions-Ct4r71CL.js";import h from"./RestrictedAccess-BXvrlePz.js";import{S as f}from"./shield-Dzd3wczT.js";import{C as _}from"./crown-DQow1lgx.js";import"./vendor-supabase-5K_8OYiR.js";import"./vendor-router-uw2sfKrb.js";import"./vendor-utils-CrFdsnXa.js";import"./badge-eiJjEpw9.js";const v=["Goleiro","Zagueiro","Meia","Atacante"];function y(){const{canSeeVote:y}=j(),{user:N}=r(),[g,w]=s.useState(null),[b,S]=s.useState([]),[A,C]=s.useState({});if(!y())return e.jsx(h,{});s.useEffect(()=>{(async()=>{const{data:e}=await a.from("v_current_polls").select("*").maybeSingle();if(w(e??null),e?.poll_id){const{data:s}=await a.from("v_poll_partials").select("poll_id,category,player_id,player_name,votes").eq("poll_id",e.poll_id);S(s??[])}})()},[]);const M=s.useMemo(()=>{const e={Goleiro:[],Zagueiro:[],Meia:[],Atacante:[]};for(const s of b)e[s.category].push(s);for(const s of v)e[s].sort((e,s)=>s.votes-e.votes||(e.player_name||"").localeCompare(s.player_name||""));return e},[b]);return e.jsxs("div",{className:"mx-auto w-full max-w-4xl p-4 sm:p-6 space-y-4 pb-20",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 shadow-sm rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Votação"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vote nos melhores jogadores da rodada"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:N?.role&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-maestros-green",children:[(s=>{switch(s){case"owner":return e.jsx(_,{className:"w-4 h-4 text-role-owner"});case"admin":return e.jsx(f,{className:"w-4 h-4 text-role-admin"});case"aux":return e.jsx(n,{className:"w-4 h-4 text-role-aux"});case"mensalista":return e.jsx(c,{className:"w-4 h-4 text-role-mensalista"});case"diarista":return e.jsx(n,{className:"w-4 h-4 text-role-diarista"});default:return e.jsx(i,{className:"w-4 h-4 text-role-default"})}})(N.role),e.jsx("span",{className:"hidden sm:inline font-medium",children:"owner"===N.role?"Dono":"admin"===N.role?"Admin":"aux"===N.role?"Auxiliar":"mensalista"===N.role?"Mensalista":"diarista"===N.role?"Diarista":"Usuário"})]})})]})}),g?e.jsx(e.Fragment,{children:v.map(s=>e.jsx(t,{className:"rounded-2xl",children:e.jsxs(l,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:s}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Fecha: ",new Date(g.closes_at).toLocaleString()]})]}),e.jsxs("div",{className:"grid sm:grid-cols-[1fr_auto] gap-2",children:[e.jsxs(d,{value:A[s]||"",onValueChange:e=>C(a=>({...a,[s]:e})),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Escolha o jogador"})}),e.jsx(p,{children:M[s].map(s=>e.jsx(u,{value:s.player_id,children:s.player_name||s.player_id},s.player_id))})]}),e.jsx(o,{onClick:()=>(async e=>{const s=A[e];if(!g?.poll_id||!s)return;const{error:r}=await a.from("ballot_choices").insert({poll_id:g.poll_id,category:e,player_id:s,voter_id:(await a.auth.getUser()).data.user?.id});if(r)alert(r.message);else{const{data:e}=await a.from("v_poll_partials").select("poll_id,category,player_id,player_name,votes").eq("poll_id",g.poll_id);S(e??[])}})(s),children:"Votar"})]}),e.jsx("div",{className:"space-y-1",children:0===M[s].length?e.jsx("div",{className:"text-xs text-zinc-500",children:"Sem votos ainda."}):M[s].map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate",children:s.player_name||s.player_id}),e.jsx("span",{className:"font-semibold",children:s.votes})]},s.player_id))})]})},s))}):e.jsx("div",{className:"text-sm text-zinc-500",children:"Nenhuma votação em andamento."})]})}export{y as default};
