import{j as e}from"./vendor-ui-3awKV8G3.js";import{r as s}from"./vendor-react-BSMgdr9Q.js";import{C as a,d as t,B as i}from"./index-Bla-05Lf.js";import{I as r}from"./input-CZj5AKC-.js";import{S as n,a as d,b as l,c,d as o}from"./select-bkGJLe9M.js";import{supabase as m}from"./supabase-CqvimHjQ.js";import{B as x}from"./badge-CsWbohDi.js";import"./vendor-router-DHox0sNQ.js";import"./vendor-supabase-D2NKQQk_.js";import"./vendor-utils-CRulVwns.js";import"./check-CzwIeJH4.js";const u=()=>{const[m,x]=s.useState(""),[u,p]=s.useState("mensalista"),[j,h]=s.useState(null),[v,f]=s.useState(!1);return e.jsx(a,{children:e.jsxs(t,{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Criar convite"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-2",children:[e.jsx(r,{value:m,onChange:e=>x(e.target.value),placeholder:"Email do convidado"}),e.jsxs(n,{value:u,onValueChange:e=>p(e),children:[e.jsx(d,{children:e.jsx(l,{placeholder:"Tipo do convite"})}),e.jsxs(c,{children:[e.jsx(o,{value:"mensalista",children:"Mensalista"}),e.jsx(o,{value:"diarista",children:"Diarista"})]})]})]}),e.jsx(i,{onClick:async()=>{if(m){f(!0);try{const e=await fetch("/api/invite/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m,membership:u})}),s=await e.json();h(s.url)}finally{f(!1)}}},disabled:v||!m,children:v?"Gerando...":"Gerar convite"}),j&&e.jsxs("div",{className:"grid sm:grid-cols-[1fr_auto_auto] gap-2",children:[e.jsx(r,{readOnly:!0,value:j}),e.jsx(i,{variant:"secondary",onClick:()=>navigator.clipboard.writeText(j),title:"Copiar link",children:"Copiar"}),e.jsx(i,{variant:"outline",onClick:()=>window.open("https://wa.me/?text="),title:"Enviar por WhatsApp",children:"WhatsApp"})]})]})})};function p(){const[n,d]=s.useState([]),[l,c]=s.useState([]),[o,p]=s.useState("");s.useEffect(()=>{(async()=>{const{data:e}=await m.from("invites").select("id,email,membership,status,token,created_at,consumed_at,used_count").order("created_at",{ascending:!1});d(e??[]);const{data:s}=await m.from("attendance_requests").select("id,user_id,match_id,status,requested_at").order("requested_at",{ascending:!1});c(s??[])})()},[]);const j=n.filter(e=>e.email.toLowerCase().includes(o.toLowerCase()));return e.jsxs("div",{className:"mx-auto w-full max-w-4xl p-4 sm:p-6 space-y-6",children:[e.jsx(u,{}),e.jsx(a,{className:"rounded-2xl",children:e.jsxs(t,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Convites"}),e.jsx(r,{value:o,onChange:e=>p(e.target.value),placeholder:"Buscar por email",className:"max-w-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[j.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-xl border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:s.email}),e.jsxs("div",{className:"text-xs text-zinc-500",children:[new Date(s.created_at).toLocaleString()," • ",s.membership]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"secondary",children:s.status}),"sent"===s.status&&e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{await m.from("invites").update({status:"revoked"}).eq("id",e),d(s=>s.map(s=>s.id===e?{...s,status:"revoked"}:s))})(s.id),children:"Revogar"})]})]},s.id)),0===j.length&&e.jsx("div",{className:"text-sm text-zinc-500",children:"Sem convites."})]})]})}),e.jsx(a,{className:"rounded-2xl",children:e.jsxs(t,{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Aprovação de Diaristas"}),e.jsxs("div",{className:"space-y-2",children:[l.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-xl border p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Req #",s.id.slice(0,8)]}),e.jsxs("div",{className:"text-xs text-zinc-500",children:[new Date(s.requested_at).toLocaleString()," • status: ",s.status]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{await m.from("attendance_requests").update({status:"approved"}).eq("id",e),c(s=>s.map(s=>s.id===e?{...s,status:"approved"}:s))})(s.id),disabled:"pending"!==s.status,children:"Aprovar"}),e.jsx(i,{size:"sm",variant:"secondary",onClick:()=>(async e=>{await m.from("attendance_requests").update({status:"rejected"}).eq("id",e),c(s=>s.map(s=>s.id===e?{...s,status:"rejected"}:s))})(s.id),disabled:"pending"!==s.status,children:"Rejeitar"})]})]},s.id)),0===l.length&&e.jsx("div",{className:"text-sm text-zinc-500",children:"Sem solicitações."})]})]})})]})}export{p as default};
