import{c as e,p as n,a as r}from"./middleware-BLDYzNRS.js";const t={number:1,inPlay:["Preto","Verde"],scores:{Preto:0,Verde:0,Cinza:0,Vermelho:0},running:!1},o=e()(n((e,n)=>({round:t,runningSince:null,accumulatedSec:0,now:Date.now(),events:[],allEvents:[],history:[],durationMin:10,setDuration:n=>e({durationMin:n}),start:()=>{const{round:r,runningSince:t}=n();r.running||null===t&&e({round:{...r,running:!0},runningSince:Date.now()})},pause:()=>{const{round:r,runningSince:t,accumulatedSec:o}=n();if(!r.running)return;const a=t?Math.floor((Date.now()-t)/1e3):0;e({round:{...r,running:!1},accumulatedSec:o+a,runningSince:null})},reset:()=>e({round:{...n().round,scores:{Preto:0,Verde:0,Cinza:0,Vermelho:0},running:!1},accumulatedSec:0,runningSince:null}),getElapsedSec:()=>{const{runningSince:e,accumulatedSec:r,now:t}=n();return r+(e?Math.floor((t-e)/1e3):0)},addGoal:r=>{const t=r.id??"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)}),o={id:t,ts:r.ts??Date.now(),team:r.team,author:r.author,assist:r.assist??null},a=[...n().events,o],s=[...n().allEvents,o],u={...n().round.scores};return u[r.team]=(u[r.team]??0)+1,e({events:a,allEvents:s,round:{...n().round,scores:u}}),t},editGoal:(r,t)=>{const o=n().events.map(e=>e.id===r?{...e,...t}:e),a=n().allEvents.map(e=>e.id===r?{...e,...t}:e);e({events:o,allEvents:a})},deleteGoal:r=>{const t=n().events.find(e=>e.id===r);if(!t)return;const o=n().events.filter(e=>e.id!==r),a=n().allEvents.filter(e=>e.id!==r),s={...n().round.scores};s[t.team]=Math.max((s[t.team]??0)-1,0),e({events:o,allEvents:a,round:{...n().round,scores:s}})},endRoundChooseNext:r=>{const{round:t,events:o}=n(),[a,s]=t.inPlay,u=t.scores[a]??0,l=t.scores[s]??0,i=u===l?"Empate":u>l?a:s,c={round:t.number,left:a,right:s,leftScore:u,rightScore:l,winner:i,ts:Date.now(),goals:[...o]},d="Empate"===i?a:i,m=["Preto","Verde","Cinza","Vermelho"].filter(e=>e!==d&&e!==a&&e!==s),x=r??m[0]??s;e({history:[...n().history,c],round:{number:t.number+1,inPlay:[d,x],scores:{Preto:0,Verde:0,Cinza:0,Vermelho:0},running:!1},accumulatedSec:0,runningSince:null,events:[],allEvents:[...n().allEvents]})},getAllEvents:()=>n().allEvents,recomputeScores:()=>{const r={Preto:0,Verde:0,Cinza:0,Vermelho:0};for(const e of n().events)r[e.team]=(r[e.team]??0)+1;e({round:{...n().round,scores:r}})},clearHistory:()=>{e({history:[]})},clearEvents:()=>{e({events:[],allEvents:[],round:{...n().round,scores:{Preto:0,Verde:0,Cinza:0,Vermelho:0}}})},clearAll:()=>{e({events:[],allEvents:[],history:[],round:{...n().round,scores:{Preto:0,Verde:0,Cinza:0,Vermelho:0}}})},resetToInitialState:()=>{e({round:t,runningSince:null,accumulatedSec:0,now:Date.now(),events:[],allEvents:[],history:[],durationMin:10})}}),{name:"maestrosfc_match",storage:r(()=>localStorage),migrate:e=>{try{const n=e;return"number"!=typeof n.accumulatedSec&&(n.accumulatedSec=0),"number"!=typeof n.now&&(n.now=Date.now()),n.round||(n.round={number:1,inPlay:["Preto","Verde"],scores:{Preto:0,Verde:0,Cinza:0,Vermelho:0},running:!1}),n.round.scores||(n.round.scores={Preto:0,Verde:0,Cinza:0,Vermelho:0}),"boolean"!=typeof n.round.running&&(n.round.running=!1),n}catch{return e}},partialize:e=>({round:e.round,runningSince:e.runningSince,accumulatedSec:e.accumulatedSec,events:e.events,allEvents:e.allEvents,history:e.history,durationMin:e.durationMin})}));let a=!1;!function(){if(a)return;a=!0;const{setState:e}=o;setInterval(()=>{e(e=>({...e,now:Date.now()}))},1e3)}();export{o as u};
